<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Galactic Directory â€” Sentinel Edition Enhanced</title>
<meta name="description" content="Self-improving, AI-enhanced directory with advanced morphing animations, particle effects, and futuristic visuals for the Planetary Restoration Archive.">
<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  ZERO-HARM / ANTI-INVERSION NOTICE                                â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘  This tool is designed for peaceful exploration of planetary      â•‘
  â•‘  restoration resources. It is NOT intended for:                   â•‘
  â•‘  â€¢ Surveillance, tracking, or profiling                           â•‘
  â•‘  â€¢ Weaponization or harmful applications                          â•‘
  â•‘  â€¢ Exploitation of user data                                      â•‘
  â•‘                                                                    â•‘
  â•‘  AI Assistant: Uses Claude API for metadata enhancement only.     â•‘
  â•‘  All data stored locally (IndexedDB). No external tracking.       â•‘
  â•‘  Open source spirit. License: MIT-style respect.                  â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<style>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: CSS Variables & Enhanced Theme System
     PURPOSE: Centralized design tokens with multiple theme support
     FEATURES: Medieval, Space, Anime, Cyberpunk themes + auto dark mode
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  :root{
    /* Base Space Theme (Default) */
    --bg:#070b14; --bg2:#0b1324; --panel:#0f1d36; --ink:#eaf1ff; --muted:#9bb0cc;
    --accent:#65b3ff; --accent2:#4ee0a1; --warn:#ffb84d; --danger:#ff6b6b; --glow:#8ad7ff;
    --good:#3bd19b; --sentinel:#7cd2ff; --peace:#7fffd4; --corrupt:#ff7f9c; --dash:#ffd166;
    --success:#4ade80; --info:#60a5fa;
    
    /* Animation Variables */
    --morph-speed: 0.6s;
    --expand-speed: 0.4s;
    --particle-speed: 2s;
    --glow-pulse: 2s;
  }
  
  /* Medieval Theme */
  [data-theme="medieval"]{
    --bg:#1a1410; --bg2:#251e18; --panel:#3a2f22; --ink:#f5e6d3; --muted:#c4a57b;
    --accent:#d4a574; --accent2:#8fbc8f; --glow:#daa520;
  }
  
  /* Anime Theme */
  [data-theme="anime"]{
    --bg:#ffe6f0; --bg2:#ffd6e8; --panel:#ffb3d9; --ink:#4a0e4e; --muted:#8b4789;
    --accent:#ff69b4; --accent2:#ff1493; --glow:#ff69b4;
  }
  
  /* Cyberpunk Theme */
  [data-theme="cyberpunk"]{
    --bg:#0a0e27; --bg2:#1a1b3a; --panel:#2d1b69; --ink:#00ffff; --muted:#ff00ff;
    --accent:#ff0080; --accent2:#00ff41; --glow:#ff0080;
  }
  
  *{box-sizing:border-box; margin:0; padding:0}
  html,body{height:100%; scroll-behavior:smooth}
  body{
    color:var(--ink); 
    background:radial-gradient(1200px 800px at 70% -10%,#12203c 0%,transparent 60%), 
               linear-gradient(180deg,var(--bg),var(--bg2) 60%,#060912);
    font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    overflow-x:hidden;
    transition: background var(--morph-speed) ease;
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Advanced Parallax & Particle System
     PURPOSE: Multi-layer animated background with morphing effects
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #stars,#constellations,#particles,#mouseTrail,#connections{
    position:fixed; inset:0; z-index:-2; pointer-events:none;
  }
  #constellations{z-index:-1}
  #particles{z-index:0; mix-blend-mode:screen}
  #mouseTrail{z-index:1; mix-blend-mode:screen}
  #connections{z-index:2; opacity:0.6}
  .parallax{transform:translateZ(0); will-change:transform}
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Enhanced Header with Theme Selector
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  header{
    position:sticky; top:0; z-index:100; 
    backdrop-filter:saturate(120%) blur(12px);
    background:linear-gradient(180deg,rgba(11,19,36,.95),rgba(11,19,36,.7));
    border-bottom:1px solid #1b2c4d; 
    box-shadow:0 4px 20px rgba(0,0,0,.3), 0 0 60px var(--glow) inset;
    transition: all var(--morph-speed) ease;
  }
  .wrap{max-width:1100px; margin:0 auto; padding:16px}
  h1{
    margin:0 0 6px; font-size:22px; letter-spacing:.4px; color:var(--accent);
    animation: titleGlow 3s ease-in-out infinite;
  }
  @keyframes titleGlow{
    0%,100%{text-shadow:0 0 10px var(--glow),0 0 20px var(--glow)}
    50%{text-shadow:0 0 20px var(--glow),0 0 40px var(--glow),0 0 60px var(--accent2)}
  }
  .sub{color:var(--muted); font-size:13px; line-height:1.4}
  
  /* Theme Selector */
  .theme-bar{
    display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; align-items:center;
  }
  .theme-btn{
    padding:6px 12px; border-radius:8px; border:1px solid #203353;
    background:#0a152a; color:var(--ink); font-size:12px; cursor:pointer;
    transition: all 0.3s ease;
  }
  .theme-btn:hover{
    transform:translateY(-2px); box-shadow:0 4px 12px var(--glow);
  }
  .theme-btn.active{
    background:var(--accent); color:#000; border-color:var(--accent);
    box-shadow:0 0 20px var(--glow);
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Enhanced HUD with Animations
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .hud{
    display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:10px;
  }
  .chip{
    background:#0a152a; border:1px solid #203353; padding:8px 10px; 
    border-radius:999px; display:flex; gap:8px; align-items:center; 
    white-space:nowrap;
    transition: all 0.3s ease;
    animation: chipFloat 3s ease-in-out infinite;
  }
  .chip:hover{
    transform:translateY(-3px) scale(1.05);
    box-shadow:0 6px 20px var(--glow);
  }
  @keyframes chipFloat{
    0%,100%{transform:translateY(0)}
    50%{transform:translateY(-3px)}
  }
  .xpbar{
    height:10px; width:220px; border-radius:999px; 
    background:#0a152a; border:1px solid #1c2d4d; overflow:hidden;
    position:relative;
  }
  .xpbar::after{
    content:''; position:absolute; inset:0;
    background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);
    animation:shimmer 2s infinite;
  }
  @keyframes shimmer{
    0%{transform:translateX(-100%)}
    100%{transform:translateX(100%)}
  }
  .xpfill{
    height:100%; width:0%; 
    background:linear-gradient(90deg,var(--accent),var(--accent2)); 
    box-shadow:0 0 14px var(--glow) inset; 
    transition:width var(--expand-speed) cubic-bezier(.4,0,.2,1);
    position:relative;
  }
  .xpfill::after{
    content:''; position:absolute; right:0; top:0; bottom:0;
    width:20px; background:rgba(255,255,255,.5);
    filter:blur(10px);
  }
  .badge{
    padding:3px 9px; border-radius:999px; font-size:11px; 
    border:1px solid; opacity:.9; font-weight:500;
    animation: badgePulse var(--glow-pulse) ease-in-out infinite;
  }
  @keyframes badgePulse{
    0%,100%{box-shadow:0 0 5px currentColor}
    50%{box-shadow:0 0 15px currentColor, 0 0 25px currentColor}
  }
  .b-sentinel{border-color:var(--sentinel); color:var(--sentinel); background:rgba(124,210,255,.05)}
  .b-peace{border-color:var(--peace); color:var(--peace); background:rgba(127,255,212,.05)}
  .b-corrupt{border-color:var(--corrupt); color:var(--corrupt); background:rgba(255,127,156,.05)}
  .b-dash{border-color:var(--dash); color:var(--dash); background:rgba(255,209,102,.05)}
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Enhanced Controls with Export Buttons
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .controls{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
  input[type="search"],input[type="text"],textarea{
    flex:1 1 320px; background:#0a152a; color:var(--ink); 
    border:1px solid #1f304f; border-radius:10px; padding:10px 12px; 
    outline:none; font-family:inherit; font-size:14px;
    transition: all 0.3s ease;
  }
  input:focus,textarea:focus{
    border-color:#2a4577; 
    box-shadow:0 0 0 3px rgba(42,69,119,.2), 0 0 20px var(--glow);
    transform:translateY(-1px);
  }
  select,button{
    background:#0a152a; color:var(--ink); border:1px solid #203353; 
    border-radius:10px; padding:10px 12px; cursor:pointer; 
    font-family:inherit; font-size:14px; 
    transition:all .3s ease;
    position:relative; overflow:hidden;
  }
  button::before{
    content:''; position:absolute; inset:0;
    background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);
    transform:translateX(-100%);
    transition:transform 0.6s;
  }
  button:hover::before{transform:translateX(100%)}
  button:hover:not(:disabled),select:hover{
    border-color:#2a4577; background:#0d1a30;
    transform:translateY(-2px);
    box-shadow:0 4px 12px var(--glow);
  }
  button:active:not(:disabled){transform:translateY(0) scale(0.98)}
  button:disabled{opacity:.5; cursor:not-allowed}
  button.primary{
    background:linear-gradient(135deg,var(--accent),var(--accent2)); 
    border-color:var(--accent); color:#000; font-weight:600;
  }
  button.primary:hover:not(:disabled){
    box-shadow:0 6px 24px var(--glow);
  }
  button.danger{border-color:var(--danger); color:var(--danger)}
  button.danger:hover:not(:disabled){background:rgba(255,107,107,.1)}
  
  .export-group{
    display:flex; gap:6px; padding:6px; background:#0a152a; 
    border-radius:10px; border:1px solid #203353;
  }
  .export-btn{
    padding:8px 12px; font-size:13px; background:transparent;
    border:none; color:var(--accent2);
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Main Content with 3D Perspective & Smooth Transitions
     PURPOSE: Enable true 3D card transformations with perspective
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  main{
    max-width:1200px; margin:18px auto 80px; padding:0 16px;
    perspective:2000px; /* Creates 3D viewing context for cards */
  }
  .grid{
    display:grid; 
    grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); 
    gap:14px;
    transform-style:preserve-3d; /* Enables 3D transformations for children */
  }
  
  /* Cascade animation for cards appearing one by one */
  .card{
    animation:cardCascadeIn 0.6s ease backwards;
  }
  .card:nth-child(1){animation-delay:0.05s}
  .card:nth-child(2){animation-delay:0.1s}
  .card:nth-child(3){animation-delay:0.15s}
  .card:nth-child(4){animation-delay:0.2s}
  .card:nth-child(5){animation-delay:0.25s}
  .card:nth-child(6){animation-delay:0.3s}
  .card:nth-child(7){animation-delay:0.35s}
  .card:nth-child(8){animation-delay:0.4s}
  .card:nth-child(9){animation-delay:0.45s}
  .card:nth-child(10){animation-delay:0.5s}
  .card:nth-child(n+11){animation-delay:0.55s}
  
  @keyframes cardCascadeIn{
    from{
      opacity:0; 
      transform:translateY(40px) translateZ(-100px) rotateX(-15deg);
    }
    to{
      opacity:1; 
      transform:translateY(0) translateZ(0) rotateX(0);
    }
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Advanced Card System with Morphing Animations
     PURPOSE: Expandable cards with particle effects and smooth transitions
     FEATURES: Hover morphing, expansion animations, ripple effects
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .card{
    background:linear-gradient(180deg,#0c1730,#0c1528);
    border:1px solid #1a2a49; border-radius:16px; padding:14px; 
    position:relative; overflow:hidden;
    transition:all var(--morph-speed) cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin:center;
    transform-style:preserve-3d;
    cursor:pointer;
    --rotateX:0deg;
    --rotateY:0deg;
  }
  
  /* Ripple Effect Container */
  .card::after{
    content:''; position:absolute; inset:0; border-radius:16px;
    background:radial-gradient(circle at var(--x,50%) var(--y,50%),
                rgba(101,179,255,.2) 0%,transparent 60%);
    opacity:0; transition:opacity 0.6s;
  }
  .card:hover::after{opacity:1}
  
  /* 3D hover effect with tilt based on mouse position */
  .card:hover{
    transform:translateY(-12px) translateZ(40px) 
              rotateX(var(--rotateX)) rotateY(var(--rotateY)) 
              scale(1.03); 
    box-shadow:0 30px 80px rgba(80,160,255,.25), 
               0 0 40px var(--glow) inset,
               0 40px 100px rgba(0,0,0,.4);
    border-color:#2a4577;
  }
  
  /* Flip animation for expanded cards */
  .card.flip-enter{
    animation:cardFlip 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
  @keyframes cardFlip{
    0%{transform:rotateY(0deg) scale(1)}
    50%{transform:rotateY(180deg) scale(1.1)}
    100%{transform:rotateY(360deg) scale(1)}
  }
  
  /* Expanded State */
  .card.expanded{
    grid-column:1/-1;
    transform:scale(1.02);
    box-shadow:0 30px 80px rgba(80,160,255,.25);
    z-index:10;
  }
  .card.expanded .description{
    max-height:500px !important;
    opacity:1 !important;
  }
  .card.expanded .full-content{
    max-height:1000px;
    opacity:1;
  }
  
  .card.loading{
    opacity:.6; pointer-events:none;
    animation:loadingPulse 1.5s ease-in-out infinite;
  }
  @keyframes loadingPulse{
    0%,100%{transform:scale(1)}
    50%{transform:scale(1.02)}
  }
  
  .card.enhanced{
    border-color:#4ee0a1; 
    box-shadow:0 0 0 1px rgba(78,224,161,.2) inset,
               0 0 30px rgba(78,224,161,.1);
    animation:enhancedGlow 2s ease-in-out infinite;
  }
  @keyframes enhancedGlow{
    0%,100%{box-shadow:0 0 0 1px rgba(78,224,161,.2) inset, 0 0 20px rgba(78,224,161,.1)}
    50%{box-shadow:0 0 0 2px rgba(78,224,161,.4) inset, 0 0 40px rgba(78,224,161,.2)}
  }
  
  .title{
    font-weight:600; color:#eaf1ff; margin:2px 0 6px; 
    word-break:break-word; font-size:16px;
    transition: all 0.3s ease;
  }
  .card:hover .title{
    color:var(--accent2);
    text-shadow:0 0 10px var(--glow);
  }
  
  .path{
    color:#9ab0cb; font-size:12px; 
    font-family:Consolas,Monaco,monospace; margin-bottom:6px;
    transition: color 0.3s ease;
  }
  .card:hover .path{color:var(--accent)}
  
  .description{
    color:#b8cce0; font-size:13px; line-height:1.5; margin:8px 0; 
    max-height:0; opacity:0; overflow:hidden;
    transition:max-height var(--expand-speed) ease, 
               opacity var(--expand-speed) ease;
  }
  .card.enhanced .description{max-height:200px; opacity:1}
  
  .full-content{
    max-height:0; opacity:0; overflow:hidden;
    transition:max-height var(--expand-speed) ease, 
               opacity var(--expand-speed) ease;
    margin-top:12px; padding-top:12px; border-top:1px solid #1a2a49;
  }
  
  .tags{
    margin-top:8px; display:flex; gap:6px; flex-wrap:wrap;
  }
  .cta{
    margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; 
    align-items:center;
  }
  .cta a,.cta button{
    text-decoration:none; padding:8px 10px; border-radius:10px; 
    border:1px solid #23406f; background:#0a152a; color:#dff2ff; 
    font-size:13px; display:inline-flex; align-items:center; gap:4px;
    transition:all 0.3s ease;
  }
  .cta a:hover,.cta button:hover{
    border-color:#3a63a4; background:#0d1a30;
    transform:translateY(-2px);
    box-shadow:0 4px 12px var(--glow);
  }
  
  /* Holographic Glow Ring */
  .glow-ring{
    position:absolute; inset:auto -20% -60% -20%; height:140px; 
    filter:blur(30px); 
    background:radial-gradient(220px 40px at 50% 0,rgba(120,210,255,.18),transparent 60%);
    animation:glowPulse var(--glow-pulse) ease-in-out infinite;
  }
  @keyframes glowPulse{
    0%,100%{opacity:0.5; transform:translateY(0)}
    50%{opacity:1; transform:translateY(-5px)}
  }
  
  .special{
    border-color:#2a6fff; 
    box-shadow:0 0 0 1px rgba(86,160,255,.25) inset,
               0 0 40px rgba(86,160,255,.15);
  }
  .special .title{color:#a5d4ff}
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Data Visualization Dashboard
     PURPOSE: Animated statistics and journey tracking
     FEATURES: Charts, graphs, and exploration metrics
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .dashboard-toggle{
    position:fixed; bottom:20px; right:20px; z-index:100;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    border:2px solid rgba(255,255,255,.2); border-radius:50%;
    width:56px; height:56px; color:#000; font-size:24px;
    cursor:pointer; box-shadow:0 6px 20px rgba(101,179,255,.5);
    transition:all 0.3s ease; display:flex; align-items:center;
    justify-content:center; animation:float 3s ease-in-out infinite;
  }
  .dashboard-toggle:hover{
    transform:scale(1.15) translateY(-5px);
    box-shadow:0 10px 30px rgba(101,179,255,.8);
  }
  
  .dashboard-panel{
    position:fixed; bottom:90px; right:20px; z-index:99;
    width:400px; max-width:calc(100vw - 40px);
    background:linear-gradient(180deg,#0f1d36,#0c1528);
    border:1px solid #2a4577; border-radius:16px;
    box-shadow:0 10px 40px rgba(0,0,0,.6), 0 0 60px var(--glow) inset;
    transform:translateY(20px) scale(0.9); opacity:0;
    pointer-events:none; transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    max-height:70vh; overflow-y:auto;
  }
  .dashboard-panel.open{
    transform:translateY(0) scale(1); opacity:1; pointer-events:auto;
  }
  
  .dashboard-header{
    padding:16px; border-bottom:1px solid #1a2a49;
    background:rgba(15,29,54,.8); display:flex;
    justify-content:space-between; align-items:center;
  }
  .dashboard-header h3{
    color:var(--accent2); font-size:16px; margin:0;
    display:flex; align-items:center; gap:8px;
  }
  
  .dashboard-content{padding:16px}
  
  .stat-card{
    background:rgba(255,255,255,.02); border:1px solid #1a2a49;
    border-radius:12px; padding:12px; margin-bottom:12px;
    transition:all 0.3s ease;
  }
  .stat-card:hover{
    border-color:#2a4577;
    box-shadow:0 4px 20px rgba(80,160,255,.1);
    transform:translateX(5px);
  }
  
  .stat-label{
    font-size:12px; color:var(--muted); text-transform:uppercase;
    letter-spacing:0.5px; margin-bottom:6px;
  }
  .stat-value{
    font-size:24px; font-weight:700; color:var(--accent2);
    display:flex; align-items:baseline; gap:8px;
  }
  .stat-subvalue{
    font-size:14px; color:var(--muted); font-weight:400;
  }
  
  .progress-bar{
    height:8px; background:#0a152a; border-radius:999px;
    overflow:hidden; margin-top:8px; position:relative;
  }
  .progress-fill{
    height:100%; background:linear-gradient(90deg,var(--accent),var(--accent2));
    border-radius:999px; transition:width 0.6s ease;
    box-shadow:0 0 10px var(--glow) inset;
  }
  
  .mini-chart{
    height:80px; margin-top:12px; position:relative;
  }
  .chart-bar{
    position:absolute; bottom:0; width:8%;
    background:linear-gradient(180deg,var(--accent2),var(--accent));
    border-radius:4px 4px 0 0; transition:height 0.6s ease;
    opacity:0.8;
  }
  .chart-bar:hover{opacity:1; filter:brightness(1.2)}
  .ai-mini-btn{
    position:fixed; top:16px; right:16px; z-index:1000; 
    width:46px; height:46px; border-radius:50%;
    background:linear-gradient(135deg,var(--accent),var(--accent2)); 
    border:2px solid rgba(255,255,255,.2); color:#000;
    font-size:20px; cursor:pointer; 
    box-shadow:0 4px 12px rgba(101,179,255,.4);
    transition:all 0.3s ease; 
    display:flex; align-items:center; justify-content:center;
    padding:0; line-height:1;
    animation:float 3s ease-in-out infinite;
  }
  @keyframes float{
    0%,100%{transform:translateY(0)}
    50%{transform:translateY(-10px)}
  }
  .ai-mini-btn:hover{
    transform:scale(1.15) translateY(-5px); 
    box-shadow:0 8px 30px rgba(101,179,255,.8);
  }
  .ai-mini-btn.pulse{
    animation:pulse 2s ease-in-out infinite, float 3s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{box-shadow:0 4px 12px rgba(101,179,255,.4)} 
    50%{box-shadow:0 6px 24px rgba(101,179,255,.8), 0 0 40px var(--glow)}
  }
  
  .ai-panel-mini{
    position:fixed; top:72px; right:16px; z-index:999; 
    width:360px; max-width:calc(100vw - 32px);
    background:linear-gradient(180deg,#0f1d36,#0c1528); 
    border:1px solid #2a4577; border-radius:12px;
    box-shadow:0 8px 24px rgba(0,0,0,.5), 0 0 40px var(--glow) inset; 
    transform:translateY(-10px) scale(0.95); opacity:0; 
    pointer-events:none; 
    transition:opacity 0.3s ease, transform 0.3s ease;
  }
  .ai-panel-mini.open{
    transform:translateY(0) scale(1); opacity:1; pointer-events:auto;
  }
  
  .ai-header-mini{
    padding:10px 12px; border-bottom:1px solid #1a2a49; 
    display:flex; justify-content:space-between; align-items:center;
    background:rgba(15,29,54,.6);
  }
  .ai-header-mini h3{
    font-size:13px; color:var(--accent2); display:flex; 
    align-items:center; gap:6px; font-weight:600;
  }
  .ai-close-mini{
    background:transparent; border:none; color:var(--muted); 
    font-size:18px; padding:0; width:20px; height:20px; cursor:pointer;
    transition:all 0.3s ease;
  }
  .ai-close-mini:hover{
    color:var(--ink); transform:rotate(90deg);
  }
  
  .ai-body-mini{
    padding:12px; max-height:320px; overflow-y:auto; font-size:13px;
  }
  .ai-body-mini::-webkit-scrollbar{width:6px}
  .ai-body-mini::-webkit-scrollbar-track{background:rgba(255,255,255,.02)}
  .ai-body-mini::-webkit-scrollbar-thumb{
    background:rgba(255,255,255,.1); border-radius:3px;
  }
  
  .ai-msg{
    margin-bottom:10px; padding:8px 10px; border-radius:8px; 
    line-height:1.4; font-size:12px;
    animation:msgSlideIn 0.3s ease;
  }
  @keyframes msgSlideIn{
    from{opacity:0; transform:translateX(-20px)}
    to{opacity:1; transform:translateX(0)}
  }
  .ai-msg.user{
    background:#1a2a49; color:var(--ink); margin-left:16px;
  }
  .ai-msg.assistant{
    background:rgba(78,224,161,.08); color:#e0f2f1; 
    margin-right:16px; border-left:2px solid var(--accent2);
  }
  .ai-msg.system{
    background:rgba(255,184,77,.08); color:#ffd699; 
    font-style:italic; text-align:center; font-size:11px; 
    padding:6px 8px;
  }
  
  .ai-input-mini{
    padding:10px 12px; border-top:1px solid #1a2a49; 
    display:flex; gap:6px; background:rgba(15,29,54,.4);
  }
  .ai-input-mini input{
    flex:1; min-width:0; background:#0a152a; color:var(--ink); 
    border:1px solid #1f304f; border-radius:8px; padding:7px 10px; 
    outline:none; font-size:12px;
    transition:all 0.3s ease;
  }
  .ai-input-mini input:focus{
    border-color:#2a4577;
    box-shadow:0 0 10px var(--glow);
  }
  .ai-input-mini button{
    background:var(--accent2); border:none; color:#000; 
    border-radius:8px; padding:7px 12px;
    font-size:12px; font-weight:600; cursor:pointer;
    transition:all 0.3s ease;
  }
  .ai-input-mini button:hover{
    background:#5ff0b1;
    box-shadow:0 4px 12px var(--glow);
    transform:translateY(-2px);
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Animated Spaceships with Enhanced Paths
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .ship{
    position:fixed; width:30px; height:30px; pointer-events:none; 
    opacity:.8; z-index:0; 
    filter:drop-shadow(0 0 6px rgba(130,200,255,.6));
    animation-timing-function:linear;
  }
  @keyframes patrolX{
    0%{transform:translateX(-10vw) rotate(0deg)}
    100%{transform:translateX(110vw) rotate(360deg)}
  }
  @keyframes patrolY{
    0%{transform:translateY(0)}
    50%{transform:translateY(12px)}
    100%{transform:translateY(0)}
  }
  .ship path{
    stroke:#a7ddff; fill:none; stroke-width:1.2;
    animation:shipGlow 2s ease-in-out infinite;
  }
  @keyframes shipGlow{
    0%,100%{stroke:#a7ddff}
    50%{stroke:var(--accent2)}
  }
  .ship:nth-child(1){
    top:12vh; left:-10vw; 
    animation:patrolX 42s infinite, patrolY 6s ease-in-out infinite;
  }
  .ship:nth-child(2){
    top:32vh; left:-15vw; 
    animation:patrolX 60s reverse infinite, patrolY 8s ease-in-out infinite;
  }
  .ship:nth-child(3){
    top:68vh; left:-20vw; 
    animation:patrolX 55s infinite, patrolY 7s ease-in-out infinite;
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Collapsible Categories with Smooth Transitions
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  details.category{
    background:linear-gradient(180deg,#0b152c,#0b1426); 
    border:1px solid #1a2a49; border-radius:16px; 
    padding:12px 14px; margin:14px 0;
    transition:all var(--morph-speed) ease;
  }
  details.category:hover{
    border-color:#2a4577;
    box-shadow:0 4px 20px rgba(80,160,255,.1);
  }
  details>summary{
    cursor:pointer; list-style:none; user-select:none; 
    font-weight:600; color:#bdddff; display:flex; 
    align-items:center; gap:8px;
    transition:color 0.3s ease;
  }
  details>summary:hover{color:var(--accent2)}
  details>summary::-webkit-details-marker{display:none}
  details>summary::before{
    content:'â–¶'; 
    transition:transform var(--expand-speed); 
    display:inline-block; width:16px;
  }
  details[open]>summary::before{transform:rotate(90deg)}
  details[open]{
    border-color:#2a4577;
    box-shadow:0 0 30px var(--glow) inset;
  }
  details .grid{margin-top:12px}
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Enhanced Toast Notifications
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .toast-container{
    position:fixed; top:80px; right:20px; z-index:300; 
    display:flex; flex-direction:column; gap:10px; 
    max-width:calc(100vw - 40px);
  }
  .toast{
    background:#0f1d36; border:1px solid #2a4577; border-radius:12px; 
    padding:12px 16px;
    box-shadow:0 8px 20px rgba(0,0,0,.4), 0 0 20px var(--glow) inset; 
    min-width:280px; animation:toastSlideIn .4s ease;
    display:flex; align-items:center; gap:10px; color:var(--ink);
  }
  .toast.success{
    border-color:var(--success); background:rgba(74,222,128,.08);
  }
  .toast.error{
    border-color:var(--danger); background:rgba(255,107,107,.08);
  }
  .toast.info{
    border-color:var(--info); background:rgba(96,165,250,.08);
  }
  @keyframes toastSlideIn{
    from{transform:translateX(400px) scale(0.8); opacity:0} 
    to{transform:translateX(0) scale(1); opacity:1}
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Footer with Enhanced Styling
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  footer{
    color:#8aa6cc; text-align:center; padding:30px 16px; 
    font-size:13px; line-height:1.6;
  }
  .zero-harm{
    background:rgba(255,255,255,.02); border:1px solid #1a2a49; 
    border-radius:12px; padding:16px; max-width:800px; 
    margin:20px auto; text-align:left;
    transition:all 0.3s ease;
  }
  .zero-harm:hover{
    border-color:#2a4577;
    box-shadow:0 4px 20px rgba(80,160,255,.1);
  }
  .zero-harm h3{
    margin:0 0 8px; color:var(--accent2); font-size:15px;
  }
  .zero-harm ul{margin:10px 0; padding-left:20px}
  .zero-harm li{margin:4px 0}
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Utility Classes
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .hide{display:none !important}
  .spinner{
    display:inline-block; width:14px; height:14px; 
    border:2px solid rgba(255,255,255,.2);
    border-top-color:var(--accent2); border-radius:50%; 
    animation:spin .6s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  
  /* Print Stylesheet */
  @media print{
    header,footer,.ship,.ai-mini-btn,.ai-panel-mini,.toast-container{display:none}
    body{background:white; color:black}
    .card{page-break-inside:avoid; border:1px solid #ccc}
  }
  
  noscript{
    display:block; padding:20px; background:var(--warn); 
    color:#000; text-align:center; font-weight:600;
  }
  
  @media(max-width:768px){
    .ai-panel-mini{width:calc(100vw - 32px); max-height:60vh}
    .grid{grid-template-columns:1fr}
    .hud{font-size:13px}
    .xpbar{width:160px}
    .ai-mini-btn{width:40px; height:40px; font-size:18px}
    h1{font-size:18px}
    .theme-bar{font-size:11px}
    .dashboard-panel{width:calc(100vw - 32px)}
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Tutorial Overlay System
     PURPOSE: Interactive guided tour for new users
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .tutorial-overlay{
    position:fixed; inset:0; background:rgba(0,0,0,0.85);
    z-index:9999; display:flex; align-items:center; justify-content:center;
    opacity:0; pointer-events:none;
    transition:opacity 0.4s ease;
  }
  .tutorial-overlay.active{opacity:1; pointer-events:auto}
  
  .tutorial-spotlight{
    position:fixed; border:3px solid var(--accent2);
    border-radius:16px; pointer-events:none;
    box-shadow:0 0 0 9999px rgba(0,0,0,0.85), 0 0 40px var(--accent2);
    transition:all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    z-index:10000;
  }
  
  .tutorial-tooltip{
    position:fixed; max-width:350px;
    background:linear-gradient(180deg,#0f1d36,#0c1528);
    border:2px solid var(--accent2); border-radius:16px;
    padding:20px; z-index:10001;
    box-shadow:0 20px 60px rgba(0,0,0,0.8), 0 0 40px var(--accent2) inset;
    transform:scale(0.9); opacity:0;
    transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .tutorial-tooltip.active{transform:scale(1); opacity:1}
  
  .tutorial-tooltip h3{
    margin:0 0 12px; color:var(--accent2); font-size:18px;
    display:flex; align-items:center; gap:8px;
  }
  .tutorial-tooltip p{
    margin:0 0 16px; color:var(--ink); line-height:1.6;
  }
  .tutorial-controls{
    display:flex; gap:10px; justify-content:space-between;
  }
  .tutorial-progress{
    font-size:12px; color:var(--muted); align-self:center;
  }
  .tutorial-btn{
    padding:8px 16px; border-radius:8px; border:1px solid var(--accent);
    background:var(--accent); color:#000; font-weight:600;
    cursor:pointer; transition:all 0.3s ease;
  }
  .tutorial-btn:hover{
    transform:translateY(-2px); box-shadow:0 4px 12px var(--glow);
  }
  .tutorial-btn.secondary{
    background:transparent; border-color:#2a4577; color:var(--ink);
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Achievement Notification System
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .achievement-container{
    position:fixed; top:20px; left:50%; transform:translateX(-50%);
    z-index:1000; display:flex; flex-direction:column; gap:12px;
    max-width:400px; pointer-events:none;
  }
  
  .achievement{
    background:linear-gradient(135deg,#1a2a49,#0f1d36);
    border:2px solid var(--accent2); border-radius:16px;
    padding:16px 20px; box-shadow:0 10px 40px rgba(0,0,0,0.6), 
                                   0 0 40px var(--accent2) inset;
    display:flex; align-items:center; gap:16px;
    animation:achievementSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    position:relative; overflow:hidden;
  }
  
  @keyframes achievementSlideIn{
    from{transform:translateY(-100px) scale(0.8); opacity:0}
    to{transform:translateY(0) scale(1); opacity:1}
  }
  
  .achievement::before{
    content:''; position:absolute; inset:0;
    background:linear-gradient(90deg,transparent,rgba(78,224,161,0.2),transparent);
    animation:achievementShimmer 2s infinite;
  }
  @keyframes achievementShimmer{
    0%{transform:translateX(-100%)}
    100%{transform:translateX(100%)}
  }
  
  .achievement-icon{
    font-size:48px; filter:drop-shadow(0 4px 12px var(--accent2));
    animation:achievementBounce 0.8s ease;
  }
  @keyframes achievementBounce{
    0%,100%{transform:scale(1)}
    50%{transform:scale(1.2) rotate(10deg)}
  }
  
  .achievement-content h4{
    margin:0 0 4px; color:var(--accent2); font-size:16px;
  }
  .achievement-content p{
    margin:0 0 6px; color:var(--ink); font-size:13px; line-height:1.4;
  }
  .achievement-xp{
    font-size:12px; color:var(--warn); font-weight:600;
  }
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: Level Up Celebration Effect
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .levelup-explosion{
    position:fixed; inset:0; pointer-events:none; z-index:9998;
  }
  
  .sound-toggle{
    position:fixed; top:70px; right:20px; z-index:99;
    background:rgba(15,29,54,0.9); border:1px solid #2a4577;
    border-radius:8px; padding:8px 12px; font-size:20px;
    cursor:pointer; transition:all 0.3s ease;
  }
  .sound-toggle:hover{
    transform:translateY(-2px); box-shadow:0 4px 12px var(--glow);
  }
  .sound-toggle.muted{opacity:0.5}
</style>
</head>
<body data-theme="space">

<canvas id="stars" class="parallax"></canvas>
<canvas id="constellations" class="parallax"></canvas>
<canvas id="particles" class="parallax"></canvas>
<canvas id="mouseTrail" class="parallax"></canvas>
<canvas id="connections" class="parallax"></canvas>

<header>
  <div class="wrap">
    <h1>Galactic Directory â€” <span style="color:var(--accent2)">Sentinel Edition Enhanced</span></h1>
    <div class="sub">AI-enhanced exploration platform with morphing animations, particle effects, and multi-theme support. Earn XP, unlock badges, and explore with style.</div>
    
    <!-- Theme Selector -->
    <div class="theme-bar">
      <span style="color:var(--muted); font-size:12px">ğŸ¨ Theme:</span>
      <button class="theme-btn active" data-theme="space">ğŸŒŒ Space</button>
      <button class="theme-btn" data-theme="medieval">âš”ï¸ Medieval</button>
      <button class="theme-btn" data-theme="anime">âœ¨ Anime</button>
      <button class="theme-btn" data-theme="cyberpunk">ğŸ”® Cyberpunk</button>
    </div>
    
    <div class="hud">
      <div class="chip" title="Your current level">Level <strong id="lvl">1</strong></div>
      <div class="chip" style="gap:10px" title="Experience points to next level">
        <div class="xpbar"><div id="xpfill" class="xpfill"></div></div>
        <span><span id="xp">0</span> / <span id="xpcap">100</span> XP</span>
      </div>
      <div class="chip">
        <span class="badge b-sentinel">SENTINEL</span> 
        <span class="badge b-peace">PEACE</span> 
        <span class="badge b-corrupt">ANTI-CORRUPTION</span> 
        <span class="badge b-dash">DASHBOARD</span>
      </div>
      <div class="chip" id="aiStatus" style="cursor:pointer" title="Click to view AI activity">
        <span style="font-size:11px">ğŸ¤– AI:</span> <span id="aiStatusText">Ready</span>
      </div>
    </div>
    
    <div class="controls">
      <input id="search" type="search" placeholder="Search directories, tags, or descriptionsâ€¦" autocomplete="off">
      <select id="filter" aria-label="Filter by category">
        <option value="">All categories</option>
        <option value="Sentinel">Sentinel</option>
        <option value="Peace">Peace</option>
        <option value="Corruption">Corruption</option>
        <option value="Dashboard">Dashboards</option>
        <option value="Education">Education</option>
        <option value="Science">Science/Tech</option>
        <option value="Community">Community</option>
        <option value="Governance">Governance</option>
        <option value="Backups">Backups/Proof</option>
        <option value="Funding">Funding</option>
        <option value="Misc">Misc</option>
      </select>
      <button id="favoritesBtn" title="Show only favorites">â˜… Favorites</button>
      <button id="enhancedBtn" title="Show only AI-enhanced directories">âœ¨ Enhanced Only</button>
      <button id="aiEnhanceBtn" class="primary" title="Let AI analyze and enhance all directories">ğŸ¤– AI Enhance All</button>
      <div class="export-group" title="Export your directory data">
        <button class="export-btn" id="exportHTML">ğŸ’¾ HTML</button>
        <button class="export-btn" id="exportJSON">ğŸ“„ JSON</button>
        <button class="export-btn" id="exportPDF">ğŸ–¨ï¸ PDF</button>
      </div>
      <button id="resetProg" class="danger">Reset Progress</button>
    </div>
  </div>
</header>

<main>
  <details class="category" open>
    <summary>â­ Featured Hubs & Quests</summary>
    <div class="grid" id="featured"></div>
  </details>

  <details class="category" open>
    <summary>ğŸ“š All Directories (<span id="dirCount">0</span>)</summary>
    <div class="grid" id="grid"></div>
  </details>
</main>

<footer>
  <div>
    Planetary Restoration Archive â€” Self-Improving Directory System
    <br>AI-Enhanced Metadata Â· Local-First Architecture Â· Zero External Tracking
    <br>Be kind; be weird; build peace.
  </div>
  
  <div class="zero-harm">
    <h3>ğŸ›¡ï¸ Zero-Harm / Anti-Inversion Notice</h3>
    <p>This tool is designed for peaceful exploration of planetary restoration resources. The AI assistant operates transparently and stores all data locally in your browser.</p>
    <p><strong>NOT intended for:</strong> Surveillance, tracking, profiling, weaponization, or harmful applications.</p>
    <p><strong>Data Storage:</strong> IndexedDB (local only). No servers. No external tracking. Full user control.</p>
    <p><strong>AI Usage:</strong> Claude API for metadata enhancement. Rate-limited. Optional. User-initiated only.</p>
    <p><strong>License:</strong> Open patterns. MIT-style respect. Attribute adapted code.</p>
  </div>
  
  <div class="zero-harm">
    <h3>ğŸ“š Technical Architecture</h3>
    <p><strong>Technology Stack:</strong> Pure vanilla JavaScript (no React, no frameworks). Standalone HTML file.</p>
    <p><strong>Animation System:</strong> CSS3 transforms, Canvas API, morphing transitions, particle effects.</p>
    <p><strong>IndexedDB Schema:</strong> Versioned (v2), automatic migrations, error recovery.</p>
    <p><strong>AI System:</strong> Context-aware enhancement using Claude API, batch processing, usage tracking.</p>
    <p><strong>Security:</strong> Input sanitization, rate limiting, CSP-ready, XSS protection.</p>
    <p><strong>Future-Proofing:</strong> Modular architecture, extensible schemas, graceful degradation.</p>
  </div>
  
  <div class="zero-harm">
    <h3>ğŸ“š Attributions & Open Source Patterns</h3>
    <ul>
      <li>Canvas animation techniques adapted from common web graphics demos (MIT patterns)</li>
      <li>IndexedDB wrapper patterns inspired by Jake Archibald's IDB library concepts</li>
      <li>Gamification mechanics adapted from open-source RPG UI frameworks</li>
      <li>AI integration patterns following Anthropic Claude API best practices</li>
      <li>Particle system concepts from web animation libraries</li>
      <li>Theme switching patterns from modern CSS frameworks</li>
    </ul>
    <p>All code substantially rewritten and documented for this specific peaceful use case.</p>
  </div>
</footer>

<svg class="ship" viewBox="0 0 24 24" aria-hidden="true"><path d="M2 12h8l2-3 2 6 4-3h4"/></svg>
<svg class="ship" viewBox="0 0 24 24" aria-hidden="true"><path d="M1 8h7l2-2 2 4 5-2h6"/></svg>
<svg class="ship" viewBox="0 0 24 24" aria-hidden="true"><path d="M0 16h9l2-4 2 5 6-1h5"/></svg>

<!-- AI Assistant - Top Right -->
<button class="ai-mini-btn pulse" id="aiMiniBtn" aria-label="Open AI Assistant" title="AI Assistant">ğŸ¤–</button>

<div class="ai-panel-mini" id="aiPanelMini">
  <div class="ai-header-mini">
    <h3><span>ğŸ¤–</span> AI Assistant</h3>
    <button class="ai-close-mini" id="aiCloseMini" aria-label="Close">Ã—</button>
  </div>
  <div class="ai-body-mini" id="aiBodyMini">
    <div class="ai-msg system">AI Assistant ready. Ask me to analyze directories, suggest improvements, or explain patterns.</div>
  </div>
  <div class="ai-input-mini">
    <input type="text" id="aiInputMini" placeholder="Ask about directories..." />
    <button id="aiSendMini">Send</button>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- Achievement Notification Container -->
<div class="achievement-container" id="achievementContainer"></div>

<!-- Tutorial Overlay System -->
<div class="tutorial-overlay" id="tutorialOverlay">
  <div class="tutorial-spotlight" id="tutorialSpotlight"></div>
  <div class="tutorial-tooltip" id="tutorialTooltip">
    <h3 id="tutorialTitle"></h3>
    <p id="tutorialText"></p>
    <div class="tutorial-controls">
      <span class="tutorial-progress" id="tutorialProgress"></span>
      <div style="display:flex; gap:10px">
        <button class="tutorial-btn secondary" id="tutorialSkip">Skip Tour</button>
        <button class="tutorial-btn" id="tutorialNext">Next</button>
      </div>
    </div>
  </div>
</div>

<!-- Level Up Celebration Canvas -->
<canvas id="levelupExplosion" class="levelup-explosion"></canvas>

<!-- Sound Toggle -->
<button class="sound-toggle" id="soundToggle" title="Toggle Sound">ğŸ”Š</button>

<!-- Data Visualization Dashboard -->
<button class="dashboard-toggle" id="dashboardToggle" aria-label="Open Dashboard" title="View Your Journey">ğŸ“Š</button>

<div class="dashboard-panel" id="dashboardPanel">
  <div class="dashboard-header">
    <h3><span>ğŸ“Š</span> Your Exploration Journey</h3>
    <button class="ai-close-mini" id="dashboardClose" aria-label="Close">Ã—</button>
  </div>
  <div class="dashboard-content" id="dashboardContent">
    <div class="stat-card">
      <div class="stat-label">Total Visits</div>
      <div class="stat-value">
        <span id="totalVisits">0</span>
        <span class="stat-subvalue">explorations</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">Directories Enhanced</div>
      <div class="stat-value">
        <span id="enhancedCount">0</span>
        <span class="stat-subvalue">/ <span id="totalDirs">0</span></span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="enhancementProgress"></div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">Favorite Categories</div>
      <div id="favCategories" style="margin-top:8px; display:flex; flex-wrap:wrap; gap:6px">
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">Activity This Week</div>
      <div class="mini-chart" id="activityChart"></div>
    </div>
  </div>
</div>

<noscript>
  <p>âš ï¸ This application requires JavaScript to function. Please enable JavaScript in your browser settings.</p>
</noscript>

<script>
"use strict";

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Pure Vanilla JavaScript - No React Dependencies
   PURPOSE: Standalone HTML file using only native browser APIs
   TECHNOLOGY: IndexedDB, Fetch API, Canvas API, DOM manipulation
   FEATURES: Advanced animations, particle systems, theme switching
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Core Configuration
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var CONFIG = {
  DB_NAME: 'GalacticDirectoryDB',
  DB_VERSION: 2,
  STORE_NAMES: {
    DIRECTORIES: 'directories',
    USER_DATA: 'userData',
    AI_LOGS: 'aiLogs'
  },
  XP: {
    PER_VISIT: 5,
    SENTINEL_BONUS: 15,
    PEACE_BONUS: 10,
    CORRUPTION_BONUS: 10,
    DASHBOARD_BONUS: 8,
    ENHANCEMENT_BONUS: 20
  },
  AI: {
    MODEL: 'claude-sonnet-4-20250514',
    MAX_TOKENS: 1000,
    RATE_LIMIT_MS: 2000,
    BATCH_SIZE: 5,
    MAX_RETRIES: 3
  },
  ANIMATION: {
    PARTICLE_COUNT: 50,
    RIPPLE_DURATION: 1000
  },
  SOUND: {
    ENABLED: true,
    VOLUME: 0.15,
    MASTER_VOLUME: 0.3
  },
  TUTORIAL: {
    SHOWN_KEY: 'tutorial-shown',
    STEPS: [
      {
        target: '.card',
        title: 'ğŸ´ Interactive Cards',
        text: 'Hover over cards to see 3D tilt effects. Click titles to expand. Double-click for flip animation!',
        position: 'bottom'
      },
      {
        target: '#aiEnhanceBtn',
        title: 'ğŸ¤– AI Enhancement',
        text: 'Let the AI analyze directories and generate rich metadata descriptions automatically.',
        position: 'bottom'
      },
      {
        target: '#dashboardToggle',
        title: 'ğŸ“Š Your Journey Dashboard',
        text: 'Track your exploration statistics, activity patterns, and favorite categories here.',
        position: 'left'
      },
      {
        target: '.theme-btn',
        title: 'ğŸ¨ Theme Switching',
        text: 'Switch between Space, Medieval, Anime, and Cyberpunk themes instantly.',
        position: 'bottom'
      }
    ]
  },
  ACHIEVEMENTS: [
    { id: 'first_visit', name: 'First Steps', desc: 'Visit your first directory', xp: 10, icon: 'ğŸš€' },
    { id: 'five_visits', name: 'Explorer', desc: 'Visit 5 directories', xp: 25, icon: 'ğŸ”' },
    { id: 'ten_visits', name: 'Pathfinder', desc: 'Visit 10 directories', xp: 50, icon: 'ğŸ§­' },
    { id: 'first_enhance', name: 'AI Pioneer', desc: 'Enhance your first directory with AI', xp: 30, icon: 'âœ¨' },
    { id: 'five_enhance', name: 'Data Curator', desc: 'Enhance 5 directories', xp: 75, icon: 'ğŸ“š' },
    { id: 'level_five', name: 'Sentinel Rank', desc: 'Reach level 5', xp: 100, icon: 'â­' },
    { id: 'all_themes', name: 'Style Master', desc: 'Try all four themes', xp: 20, icon: 'ğŸ¨' },
    { id: 'dashboard_opened', name: 'Data Aware', desc: 'Open the analytics dashboard', xp: 15, icon: 'ğŸ“Š' }
  ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Error Handling System
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var ErrorHandler = {
  handle: function(error, context) {
    context = context || 'Unknown';
    console.error('[' + context + ']', error);
    
    var userMessage = this.getUserMessage(error, context);
    Toast.show(userMessage, 'error');
    
    this.logError(error, context).catch(function(e) {
      console.warn('Failed to log error:', e);
    });
  },
  
  getUserMessage: function(error, context) {
    if (error.name === 'QuotaExceededError') {
      return 'Storage quota exceeded. Please clear some browser data.';
    }
    if (error.message && error.message.indexOf('fetch') !== -1) {
      return 'Network error. Please check your connection.';
    }
    if (context.indexOf('AI') !== -1) {
      return 'AI assistant encountered an error. Please try again.';
    }
    return 'An unexpected error occurred. Your data is safe.';
  },
  
  logError: function(error, context) {
    return DB.open().then(function(db) {
      var log = {
        timestamp: Date.now(),
        context: context,
        message: error.message,
        stack: error.stack ? error.stack.substring(0, 500) : ''
      };
      return DB.add(CONFIG.STORE_NAMES.AI_LOGS, log);
    }).catch(function(e) {
      console.warn('Silent error logging failure:', e);
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Toast Notification System with Animations
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var Toast = {
  show: function(message, type, duration) {
    type = type || 'info';
    duration = duration || 4000;
    
    var container = document.getElementById('toastContainer');
    if (!container) return;
    
    var toast = document.createElement('div');
    toast.className = 'toast ' + type;
    
    var icon = type === 'success' ? 'âœ”' : type === 'error' ? 'âš ' : 'â„¹';
    toast.innerHTML = '<span style="font-size:18px">' + icon + '</span><span>' + message + '</span>';
    
    container.appendChild(toast);
    
    setTimeout(function() {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(400px) scale(0.8)';
      setTimeout(function() {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, duration);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: IndexedDB Wrapper (Pure Promises)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var DB = {
  db: null,
  
  open: function() {
    var self = this;
    if (this.db) return Promise.resolve(this.db);
    
    return new Promise(function(resolve, reject) {
      var request = indexedDB.open(CONFIG.DB_NAME, CONFIG.DB_VERSION);
      
      request.onerror = function() {
        reject(request.error);
      };
      
      request.onsuccess = function() {
        self.db = request.result;
        resolve(self.db);
      };
      
      request.onupgradeneeded = function(event) {
        var db = event.target.result;
        var oldVersion = event.oldVersion;
        
        if (oldVersion < 1) {
          var dirStore = db.createObjectStore(CONFIG.STORE_NAMES.DIRECTORIES, { keyPath: 'path' });
          dirStore.createIndex('tags', 'tags', { multiEntry: true });
          dirStore.createIndex('enhanced', 'enhanced');
          
          db.createObjectStore(CONFIG.STORE_NAMES.USER_DATA, { keyPath: 'key' });
          db.createObjectStore(CONFIG.STORE_NAMES.AI_LOGS, { keyPath: 'timestamp' });
        }
        
        if (oldVersion < 2) {
          var transaction = event.target.transaction;
          var dirStore = transaction.objectStore(CONFIG.STORE_NAMES.DIRECTORIES);
          if (!dirStore.indexNames.contains('visitCount')) {
            dirStore.createIndex('visitCount', 'visitCount');
          }
        }
      };
    });
  },
  
  put: function(storeName, data) {
    return this.open().then(function(db) {
      return new Promise(function(resolve, reject) {
        var transaction = db.transaction(storeName, 'readwrite');
        var request = transaction.objectStore(storeName).put(data);
        request.onsuccess = function() { resolve(request.result); };
        request.onerror = function() { reject(request.error); };
      });
    });
  },
  
  get: function(storeName, key) {
    return this.open().then(function(db) {
      return new Promise(function(resolve, reject) {
        var transaction = db.transaction(storeName, 'readonly');
        var request = transaction.objectStore(storeName).get(key);
        request.onsuccess = function() { resolve(request.result); };
        request.onerror = function() { reject(request.error); };
      });
    });
  },
  
  getAll: function(storeName) {
    return this.open().then(function(db) {
      return new Promise(function(resolve, reject) {
        var transaction = db.transaction(storeName, 'readonly');
        var request = transaction.objectStore(storeName).getAll();
        request.onsuccess = function() { resolve(request.result); };
        request.onerror = function() { reject(request.error); };
      });
    });
  },
  
  clear: function(storeName) {
    return this.open().then(function(db) {
      return new Promise(function(resolve, reject) {
        var transaction = db.transaction(storeName, 'readwrite');
        var request = transaction.objectStore(storeName).clear();
        request.onsuccess = function() { resolve(); };
        request.onerror = function() { reject(request.error); };
      });
    });
  },
  
  add: function(storeName, data) {
    return this.open().then(function(db) {
      return new Promise(function(resolve, reject) {
        var transaction = db.transaction(storeName, 'readwrite');
        var request = transaction.objectStore(storeName).add(data);
        request.onsuccess = function() { resolve(request.result); };
        request.onerror = function() { reject(request.error); };
      });
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Advanced Background Animation System
   PURPOSE: Multi-layer parallax with morphing constellations, particles,
            mouse trails, and dynamic directory connection visualization
   FEATURES: 5-layer canvas system with interactive effects
   
   HOW IT WORKS:
   - Layer 1 (stars): Twinkling stars with parallax scrolling
   - Layer 2 (constellations): Morphing lines that respond to mouse
   - Layer 3 (particles): Floating ambient particles
   - Layer 4 (mouseTrail): Glowing trail following mouse cursor
   - Layer 5 (connections): Lines connecting related directory cards
   
   EXPECTED BEHAVIOR:
   - Stars drift and twinkle as you scroll
   - Constellations bend toward your mouse position
   - Particles float with realistic physics
   - Mouse trail creates magical comet effect
   - Connection lines pulse between card pairs
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function initBackground(){
  var stars = document.getElementById('stars');
  var cons = document.getElementById('constellations');
  var particles = document.getElementById('particles');
  var mouseTrail = document.getElementById('mouseTrail');
  var connections = document.getElementById('connections');
  
  if (!stars || !cons || !particles || !mouseTrail || !connections) return;
  
  var DPR = Math.min(2, window.devicePixelRatio || 1);
  var W = window.innerWidth;
  var H = window.innerHeight;
  var scrollY = 0;
  var mouseX = W / 2;
  var mouseY = H / 2;
  var prevMouseX = mouseX;
  var prevMouseY = mouseY;

  function sizeCanv(){ 
    W = window.innerWidth; 
    H = window.innerHeight;
    [stars, cons, particles, mouseTrail, connections].forEach(function(c) { 
      c.width = W * DPR; 
      c.height = H * DPR; 
      c.style.width = W + 'px'; 
      c.style.height = H + 'px'; 
    });
  }
  sizeCanv(); 
  window.addEventListener('resize', sizeCanv);
  window.addEventListener('scroll', function() {
    scrollY = window.pageYOffset || document.documentElement.scrollTop;
  });
  window.addEventListener('mousemove', function(e) {
    prevMouseX = mouseX;
    prevMouseY = mouseY;
    mouseX = e.clientX;
    mouseY = e.clientY;
  });

  var sctx = stars.getContext('2d');
  var cctx = cons.getContext('2d');
  var pctx = particles.getContext('2d');
  var mctx = mouseTrail.getContext('2d');
  var connCtx = connections.getContext('2d');
  var rand = function(n) { return Math.random() * n; };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // STARS LAYER: Twinkling stars with parallax and drift
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var STAR_COUNT = Math.min(450, Math.floor(W * H / 3500));
  var pts = [];
  for (var i = 0; i < STAR_COUNT; i++) {
    pts.push({ 
      x: rand(W), 
      y: rand(H), 
      r: Math.random() * 1.4 + 0.2, 
      a: Math.random(),
      baseY: 0,
      vx: (Math.random() - 0.5) * 0.05,
      vy: (Math.random() - 0.5) * 0.05
    });
  }
  pts.forEach(function(p) { p.baseY = p.y; });
  
  function drawStars(){
    sctx.clearRect(0, 0, W * DPR, H * DPR);
    sctx.save(); 
    sctx.scale(DPR, DPR);
    
    pts.forEach(function(p) {
      // Twinkling effect through alpha oscillation
      p.a += (Math.random() - 0.5) * 0.04;
      var a = 0.5 + 0.5 * Math.sin(p.a);
      
      // Mouse parallax creates depth perception
      var dx = (mouseX - W / 2) * 0.01 * p.r;
      var dy = (mouseY - H / 2) * 0.01 * p.r;
      
      // Combine scroll parallax with mouse parallax
      var parallaxY = p.baseY + scrollY * 0.05 * (p.r / 1.4) + dy;
      p.y = parallaxY % H;
      p.x = (p.x + p.vx + dx) % W;
      if (p.x < 0) p.x += W;
      
      sctx.fillStyle = 'rgba(180,210,255,' + (0.3 + 0.7 * a) + ')';
      sctx.shadowBlur = 4;
      sctx.shadowColor = 'rgba(180,210,255,0.5)';
      sctx.beginPath(); 
      sctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); 
      sctx.fill();
    });
    
    sctx.restore();
    requestAnimationFrame(drawStars);
  }
  drawStars();

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONSTELLATION LAYER: Morphing lines responsive to mouse
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var constellationNodes = [];
  for (var i = 0; i < 12; i++) {
    var nodes = [];
    for (var j = 0; j < 6; j++) {
      nodes.push({
        baseX: (i / 12) * W + 30 * Math.sin(i) + (j * 20) + 10 * Math.cos(i + j),
        baseY: (H * (i % 2 ? 0.2 : 0.7)) + 18 * j + 14 * Math.sin(i * j),
        x: 0,
        y: 0,
        phase: i + j,
        targetX: 0,
        targetY: 0
      });
    }
    constellationNodes.push(nodes);
  }
  
  var time = 0;
  function drawConstellations(){
    time += 0.01;
    cctx.clearRect(0, 0, W * DPR, H * DPR);
    cctx.save(); 
    cctx.scale(DPR, DPR);
    cctx.strokeStyle = 'rgba(120,190,255,.12)';
    cctx.lineWidth = 1;
    
    var scrollFactor = Math.sin(scrollY * 0.001 + time) * 20;
    var waveFactor = Math.cos(scrollY * 0.0015 + time) * 15;
    
    constellationNodes.forEach(function(nodes, i) {
      cctx.beginPath();
      nodes.forEach(function(node, j) {
        // Calculate distance from mouse to create gravitational pull effect
        var mouseDist = Math.sqrt(Math.pow(mouseX - node.baseX, 2) + Math.pow(mouseY - node.baseY, 2));
        var morphFactor = Math.max(0, 1 - mouseDist / 300);
        
        // Morph constellation toward mouse with smooth interpolation
        node.x = node.baseX + scrollFactor * Math.sin(node.phase + time * 2) + 
                 (mouseX - W / 2) * 0.02 * morphFactor;
        node.y = (node.baseY + scrollY * 0.08 * (i % 2 ? 1 : -1)) % H + 
                 waveFactor * Math.cos(node.phase + time) +
                 (mouseY - H / 2) * 0.02 * morphFactor;
        
        if (j === 0) cctx.moveTo(node.x, node.y); 
        else cctx.lineTo(node.x, node.y);
        
        // Glowing nodes that pulse with time
        var pulse = 0.3 + 0.2 * Math.sin(time * 3 + node.phase);
        cctx.fillStyle = 'rgba(120,190,255,' + pulse + ')';
        cctx.shadowBlur = 8;
        cctx.shadowColor = 'rgba(120,190,255,0.8)';
        cctx.beginPath();
        cctx.arc(node.x, node.y, 2, 0, Math.PI * 2);
        cctx.fill();
      });
      cctx.stroke();
    });
    
    cctx.restore();
    requestAnimationFrame(drawConstellations);
  }
  drawConstellations();
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PARTICLE LAYER: Floating ambient particles with physics
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var particleList = [];
  for (var i = 0; i < CONFIG.ANIMATION.PARTICLE_COUNT; i++) {
    particleList.push({
      x: rand(W),
      y: rand(H),
      vx: (Math.random() - 0.5) * 0.5,
      vy: (Math.random() - 0.5) * 0.5,
      r: Math.random() * 2 + 0.5,
      life: Math.random()
    });
  }
  
  function drawParticles(){
    pctx.clearRect(0, 0, W * DPR, H * DPR);
    pctx.save();
    pctx.scale(DPR, DPR);
    
    particleList.forEach(function(p) {
      p.x += p.vx;
      p.y += p.vy;
      p.life += 0.01;
      
      // Bounce off edges with damping
      if (p.x < 0 || p.x > W) p.vx *= -1;
      if (p.y < 0 || p.y > H) p.vy *= -1;
      
      var alpha = 0.3 * Math.sin(p.life);
      pctx.fillStyle = 'rgba(78,224,161,' + Math.abs(alpha) + ')';
      pctx.shadowBlur = 6;
      pctx.shadowColor = 'rgba(78,224,161,0.5)';
      pctx.beginPath();
      pctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      pctx.fill();
    });
    
    pctx.restore();
    requestAnimationFrame(drawParticles);
  }
  drawParticles();
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MOUSE TRAIL LAYER: Comet-like trail following cursor
  // HOW IT WORKS: Stores last 20 mouse positions and draws gradient
  // EXPECTED BEHAVIOR: Creates smooth trailing effect like shooting star
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var trailPoints = [];
  var maxTrailLength = 20;
  
  window.addEventListener('mousemove', function(e) {
    trailPoints.push({
      x: e.clientX,
      y: e.clientY,
      life: 1.0
    });
    if (trailPoints.length > maxTrailLength) {
      trailPoints.shift();
    }
  });
  
  function drawMouseTrail(){
    mctx.clearRect(0, 0, W * DPR, H * DPR);
    mctx.save();
    mctx.scale(DPR, DPR);
    
    // Fade out old trail points
    trailPoints.forEach(function(p) {
      p.life *= 0.92;
    });
    
    // Remove dead points
    trailPoints = trailPoints.filter(function(p) { return p.life > 0.05; });
    
    // Draw trail as connected gradient circles
    trailPoints.forEach(function(p, i) {
      var size = 8 * p.life;
      var alpha = 0.4 * p.life;
      
      var gradient = mctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, size);
      gradient.addColorStop(0, 'rgba(101,179,255,' + alpha + ')');
      gradient.addColorStop(1, 'rgba(101,179,255,0)');
      
      mctx.fillStyle = gradient;
      mctx.beginPath();
      mctx.arc(p.x, p.y, size, 0, Math.PI * 2);
      mctx.fill();
    });
    
    mctx.restore();
    requestAnimationFrame(drawMouseTrail);
  }
  drawMouseTrail();
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONNECTION LAYER: Dynamic lines between related directory cards
  // HOW TO USE: Call updateConnections() when cards are rendered
  // EXPECTED OUTCOME: Pulsing lines connect related directories
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  window.updateConnections = function() {
    connCtx.clearRect(0, 0, W * DPR, H * DPR);
    connCtx.save();
    connCtx.scale(DPR, DPR);
    
    var cards = document.querySelectorAll('.card');
    var cardPositions = [];
    
    cards.forEach(function(card) {
      var rect = card.getBoundingClientRect();
      var tags = card.dataset.path ? autoTag(card.dataset.path) : [];
      cardPositions.push({
        x: rect.left + rect.width / 2,
        y: rect.top + rect.height / 2,
        tags: tags,
        element: card
      });
    });
    
    // Draw connections between cards with shared tags
    connCtx.strokeStyle = 'rgba(78,224,161,0.15)';
    connCtx.lineWidth = 1;
    
    for (var i = 0; i < cardPositions.length; i++) {
      for (var j = i + 1; j < cardPositions.length; j++) {
        var hasSharedTag = cardPositions[i].tags.some(function(tag) {
          return cardPositions[j].tags.indexOf(tag) !== -1;
        });
        
        if (hasSharedTag) {
          connCtx.beginPath();
          connCtx.moveTo(cardPositions[i].x, cardPositions[i].y);
          connCtx.lineTo(cardPositions[j].x, cardPositions[j].y);
          connCtx.stroke();
        }
      }
    }
    
    connCtx.restore();
  };
  
  // Update connections periodically
  setInterval(function() {
    if (window.updateConnections) window.updateConnections();
  }, 2000);
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Dashboard Manager
   PURPOSE: Track and visualize user's exploration journey
   FEATURES: Real-time statistics, activity charts, category analysis
   
   HOW IT WORKS:
   - Tracks all directory visits and stores timestamps
   - Calculates enhancement progress percentage
   - Analyzes favorite categories based on visit frequency
   - Generates animated bar chart of daily activity
   
   HOW TO USE:
   - Dashboard.init() on page load
   - Dashboard.update() after any directory interaction
   - Dashboard automatically refreshes every 5 seconds
   
   EXPECTED OUTCOME:
   - Beautiful animated statistics panel
   - Visual feedback on exploration progress
   - Insights into usage patterns
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var Dashboard = {
  isOpen: false,
  updateInterval: null,
  
  init: function() {
    var self = this;
    var toggle = document.getElementById('dashboardToggle');
    var panel = document.getElementById('dashboardPanel');
    var closeBtn = document.getElementById('dashboardClose');
    
    if (toggle && panel) {
      toggle.addEventListener('click', function() {
        self.toggle();
      });
    }
    
    if (closeBtn && panel) {
      closeBtn.addEventListener('click', function() {
        self.close();
      });
    }
    
    // Auto-update every 5 seconds when open
    this.updateInterval = setInterval(function() {
      if (self.isOpen) {
        self.update();
      }
    }, 5000);
    
    // Initial update
    this.update();
  },
  
  toggle: function() {
    var panel = document.getElementById('dashboardPanel');
    if (!panel) return;
    
    this.isOpen = !this.isOpen;
    if (this.isOpen) {
      panel.classList.add('open');
      this.update();
    } else {
      panel.classList.remove('open');
    }
  },
  
  close: function() {
    var panel = document.getElementById('dashboardPanel');
    if (!panel) return;
    
    this.isOpen = false;
    panel.classList.remove('open');
  },
  
  update: function() {
    var self = this;
    
    Promise.all([
      DB.getAll(CONFIG.STORE_NAMES.DIRECTORIES),
      DB.getAll(CONFIG.STORE_NAMES.USER_DATA)
    ]).then(function(results) {
      var allDirs = results[0];
      
      // Calculate statistics
      var totalVisits = 0;
      var enhancedCount = 0;
      var categoryVisits = {};
      var dailyActivity = {};
      
      allDirs.forEach(function(dir) {
        if (dir.visitCount) {
          totalVisits += dir.visitCount;
        }
        if (dir.enhanced) {
          enhancedCount++;
        }
        
        // Track category visits
        var tags = dir.tags || autoTag(dir.path);
        tags.forEach(function(tag) {
          categoryVisits[tag] = (categoryVisits[tag] || 0) + (dir.visitCount || 0);
        });
        
        // Track daily activity
        if (dir.lastVisit) {
          var date = new Date(dir.lastVisit);
          var dayKey = date.toISOString().split('T')[0];
          dailyActivity[dayKey] = (dailyActivity[dayKey] || 0) + 1;
        }
      });
      
      // Update DOM
      var totalVisitsEl = document.getElementById('totalVisits');
      if (totalVisitsEl) {
        self.animateNumber(totalVisitsEl, parseInt(totalVisitsEl.textContent) || 0, totalVisits);
      }
      
      var enhancedCountEl = document.getElementById('enhancedCount');
      var totalDirsEl = document.getElementById('totalDirs');
      if (enhancedCountEl && totalDirsEl) {
        self.animateNumber(enhancedCountEl, parseInt(enhancedCountEl.textContent) || 0, enhancedCount);
        totalDirsEl.textContent = DIRS.length;
      }
      
      var progressBar = document.getElementById('enhancementProgress');
      if (progressBar) {
        var percentage = (enhancedCount / DIRS.length) * 100;
        progressBar.style.width = percentage + '%';
      }
      
      // Update favorite categories
      self.renderFavoriteCategories(categoryVisits);
      
      // Update activity chart
      self.renderActivityChart(dailyActivity);
      
    }).catch(function(error) {
      ErrorHandler.handle(error, 'Dashboard.update');
    });
  },
  
  animateNumber: function(element, start, end) {
    var duration = 1000;
    var startTime = Date.now();
    
    function update() {
      var elapsed = Date.now() - startTime;
      var progress = Math.min(elapsed / duration, 1);
      var current = Math.floor(start + (end - start) * progress);
      element.textContent = current;
      
      if (progress < 1) {
        requestAnimationFrame(update);
      }
    }
    
    update();
  },
  
  renderFavoriteCategories: function(categoryVisits) {
    var container = document.getElementById('favCategories');
    if (!container) return;
    
    var sorted = Object.keys(categoryVisits).sort(function(a, b) {
      return categoryVisits[b] - categoryVisits[a];
    }).slice(0, 5);
    
    container.innerHTML = '';
    sorted.forEach(function(category) {
      var badge = document.createElement('span');
      badge.className = 'badge';
      if (category === 'Sentinel') badge.className += ' b-sentinel';
      else if (category === 'Peace') badge.className += ' b-peace';
      else if (category === 'Corruption') badge.className += ' b-corrupt';
      else if (category === 'Dashboard') badge.className += ' b-dash';
      badge.textContent = category + ' (' + categoryVisits[category] + ')';
      container.appendChild(badge);
    });
  },
  
  renderActivityChart: function(dailyActivity) {
    var container = document.getElementById('activityChart');
    if (!container) return;
    
    // Get last 7 days
    var days = [];
    for (var i = 6; i >= 0; i--) {
      var date = new Date();
      date.setDate(date.getDate() - i);
      days.push(date.toISOString().split('T')[0]);
    }
    
    container.innerHTML = '';
    var maxActivity = Math.max.apply(null, days.map(function(day) {
      return dailyActivity[day] || 0;
    })) || 1;
    
    days.forEach(function(day, i) {
      var activity = dailyActivity[day] || 0;
      var bar = document.createElement('div');
      bar.className = 'chart-bar';
      bar.style.left = (i * 13) + '%';
      bar.style.height = ((activity / maxActivity) * 70) + 'px';
      bar.title = day + ': ' + activity + ' visits';
      container.appendChild(bar);
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: 3D Card Tilt System
   PURPOSE: Track mouse position relative to cards for 3D rotation
   
   HOW IT WORKS:
   - Listens to mousemove on each card
   - Calculates mouse position relative to card center
   - Converts position to rotation angles (X and Y axis)
   - Updates CSS custom properties for smooth transform
   
   HOW TO USE:
   - Call CardTilt.attach(cardElement) when creating cards
   - Card automatically tilts toward mouse when hovering
   
   EXPECTED OUTCOME:
   - Cards tilt naturally toward your cursor
   - Creates 3D holographic interface feeling
   - Smooth interpolation prevents jitter
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var CardTilt = {
  attach: function(card) {
    var self = this;
    
    card.addEventListener('mousemove', function(e) {
      var rect = card.getBoundingClientRect();
      var x = e.clientX - rect.left;
      var y = e.clientY - rect.top;
      var centerX = rect.width / 2;
      var centerY = rect.height / 2;
      
      // Calculate rotation angles (-15 to +15 degrees)
      var rotateX = ((y - centerY) / centerY) * -15;
      var rotateY = ((x - centerX) / centerX) * 15;
      
      card.style.setProperty('--rotateX', rotateX + 'deg');
      card.style.setProperty('--rotateY', rotateY + 'deg');
      
      // Update ripple position
      RippleEffect.create(card, x, y);
    });
    
    card.addEventListener('mouseleave', function() {
      card.style.setProperty('--rotateX', '0deg');
      card.style.setProperty('--rotateY', '0deg');
    });
    
    // Flip animation on double-click
    card.addEventListener('dblclick', function() {
      if (!card.classList.contains('flip-enter')) {
        card.classList.add('flip-enter');
        SoundSystem.play('whoosh'); // Play whoosh sound on flip
        setTimeout(function() {
          card.classList.remove('flip-enter');
        }, 800);
      }
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Web Audio API Sound System
   PURPOSE: Procedural sound generation for UI feedback
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var SoundSystem = {
  context: null,
  masterGain: null,
  enabled: true,
  
  init: function() {
    try {
      var AudioContext = window.AudioContext || window.webkitAudioContext;
      this.context = new AudioContext();
      this.masterGain = this.context.createGain();
      this.masterGain.gain.value = CONFIG.SOUND.MASTER_VOLUME;
      this.masterGain.connect(this.context.destination);
      this.enabled = CONFIG.SOUND.ENABLED;
      console.log('âœ“ Sound system initialized');
    } catch(e) {
      console.warn('Web Audio API not supported:', e);
      this.enabled = false;
    }
  },
  
  toggle: function() {
    this.enabled = !this.enabled;
    var btn = document.getElementById('soundToggle');
    if (btn) {
      btn.textContent = this.enabled ? 'ğŸ”Š' : 'ğŸ”‡';
      btn.classList.toggle('muted', !this.enabled);
    }
    Toast.show('Sound ' + (this.enabled ? 'enabled' : 'disabled'), 'info', 2000);
  },
  
  play: function(type) {
    if (!this.enabled || !this.context) return;
    var now = this.context.currentTime;
    switch(type) {
      case 'click': this.playClick(now); break;
      case 'hover': this.playHover(now); break;
      case 'success': this.playSuccess(now); break;
      case 'levelup': this.playLevelUp(now); break;
      case 'whoosh': this.playWhoosh(now); break;
      case 'enhance': this.playEnhance(now); break;
    }
  },
  
  playClick: function(time) {
    var osc = this.context.createOscillator();
    var gain = this.context.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(800, time);
    gain.gain.setValueAtTime(CONFIG.SOUND.VOLUME, time);
    gain.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
    osc.connect(gain);
    gain.connect(this.masterGain);
    osc.start(time);
    osc.stop(time + 0.05);
  },
  
  playHover: function(time) {
    var osc = this.context.createOscillator();
    var gain = this.context.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(400, time);
    gain.gain.setValueAtTime(CONFIG.SOUND.VOLUME * 0.3, time);
    gain.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
    osc.connect(gain);
    gain.connect(this.masterGain);
    osc.start(time);
    osc.stop(time + 0.1);
  },
  
  playSuccess: function(time) {
    var frequencies = [261.63, 329.63, 392.00];
    var self = this;
    frequencies.forEach(function(freq, i) {
      var osc = self.context.createOscillator();
      var gain = self.context.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, time + i * 0.05);
      gain.gain.setValueAtTime(CONFIG.SOUND.VOLUME * 0.4, time + i * 0.05);
      gain.gain.exponentialRampToValueAtTime(0.01, time + i * 0.05 + 0.5);
      osc.connect(gain);
      gain.connect(self.masterGain);
      osc.start(time + i * 0.05);
      osc.stop(time + i * 0.05 + 0.5);
    });
  },
  
  playLevelUp: function(time) {
    var frequencies = [261.63, 329.63, 392.00, 523.25];
    var self = this;
    frequencies.forEach(function(freq, i) {
      var osc = self.context.createOscillator();
      var gain = self.context.createGain();
      osc.type = 'triangle';
      osc.frequency.setValueAtTime(freq, time + i * 0.08);
      osc.frequency.exponentialRampToValueAtTime(freq * 1.5, time + i * 0.08 + 0.3);
      gain.gain.setValueAtTime(CONFIG.SOUND.VOLUME * 0.5, time + i * 0.08);
      gain.gain.exponentialRampToValueAtTime(0.01, time + i * 0.08 + 0.8);
      osc.connect(gain);
      gain.connect(self.masterGain);
      osc.start(time + i * 0.08);
      osc.stop(time + i * 0.08 + 0.8);
    });
  },
  
  playWhoosh: function(time) {
    var osc = this.context.createOscillator();
    var gain = this.context.createGain();
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(200, time);
    osc.frequency.exponentialRampToValueAtTime(50, time + 0.3);
    gain.gain.setValueAtTime(CONFIG.SOUND.VOLUME * 0.2, time);
    gain.gain.exponentialRampToValueAtTime(0.01, time + 0.3);
    osc.connect(gain);
    gain.connect(this.masterGain);
    osc.start(time);
    osc.stop(time + 0.3);
  },
  
  playEnhance: function(time) {
    var frequencies = [800, 1200, 1600];
    var self = this;
    frequencies.forEach(function(freq, i) {
      var osc = self.context.createOscillator();
      var gain = self.context.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, time + i * 0.05);
      gain.gain.setValueAtTime(CONFIG.SOUND.VOLUME * 0.3, time + i * 0.05);
      gain.gain.exponentialRampToValueAtTime(0.01, time + i * 0.05 + 0.4);
      osc.connect(gain);
      gain.connect(self.masterGain);
      osc.start(time + i * 0.05);
      osc.stop(time + i * 0.05 + 0.4);
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Achievement System
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var AchievementSystem = {
  unlocked: {},
  themesTried: {},
  
  init: function() {
    var self = this;
    return DB.get(CONFIG.STORE_NAMES.USER_DATA, 'achievements').then(function(data) {
      if (data && data.value) {
        self.unlocked = data.value.unlocked || {};
        self.themesTried = data.value.themesTried || {};
      }
    }).catch(function(error) {
      console.warn('Achievement init error:', error);
    });
  },
  
  save: function() {
    return DB.put(CONFIG.STORE_NAMES.USER_DATA, {
      key: 'achievements',
      value: {
        unlocked: this.unlocked,
        themesTried: this.themesTried
      }
    });
  },
  
  check: function(trigger, value) {
    var self = this;
    CONFIG.ACHIEVEMENTS.forEach(function(achievement) {
      if (self.unlocked[achievement.id]) return;
      var shouldUnlock = false;
      if (achievement.id === 'first_visit' && trigger === 'visit' && value >= 1) shouldUnlock = true;
      else if (achievement.id === 'five_visits' && trigger === 'visit' && value >= 5) shouldUnlock = true;
      else if (achievement.id === 'ten_visits' && trigger === 'visit' && value >= 10) shouldUnlock = true;
      else if (achievement.id === 'first_enhance' && trigger === 'enhance' && value >= 1) shouldUnlock = true;
      else if (achievement.id === 'five_enhance' && trigger === 'enhance' && value >= 5) shouldUnlock = true;
      else if (achievement.id === 'level_five' && trigger === 'level' && value >= 5) shouldUnlock = true;
      else if (achievement.id === 'all_themes' && trigger === 'themes' && Object.keys(self.themesTried).length >= 4) shouldUnlock = true;
      else if (achievement.id === 'dashboard_opened' && trigger === 'dashboard') shouldUnlock = true;
      if (shouldUnlock) self.unlock(achievement);
    });
  },
  
  unlock: function(achievement) {
    this.unlocked[achievement.id] = Date.now();
    this.save();
    State.addXP(achievement.xp);
    SoundSystem.play('success');
    this.showNotification(achievement);
  },
  
  showNotification: function(achievement) {
    var container = document.getElementById('achievementContainer');
    if (!container) return;
    var notification = document.createElement('div');
    notification.className = 'achievement';
    notification.innerHTML = 
      '<div class="achievement-icon">' + achievement.icon + '</div>' +
      '<div class="achievement-content">' +
        '<h4>Achievement Unlocked!</h4>' +
        '<p><strong>' + achievement.name + '</strong> - ' + achievement.desc + '</p>' +
        '<div class="achievement-xp">+' + achievement.xp + ' XP</div>' +
      '</div>';
    container.appendChild(notification);
    setTimeout(function() {
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(-50px) scale(0.8)';
      setTimeout(function() {
        if (notification.parentNode) notification.parentNode.removeChild(notification);
      }, 400);
    }, 5000);
  },
  
  trackTheme: function(theme) {
    this.themesTried[theme] = true;
    this.save();
    this.check('themes');
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Ripple Effect System
   PURPOSE: Create ripple animations on card interactions
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var RippleEffect = {
  create: function(element, x, y) {
    element.style.setProperty('--x', x + 'px');
    element.style.setProperty('--y', y + 'px');
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Theme System
   PURPOSE: Dynamic theme switching with smooth transitions
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var ThemeManager = {
  currentTheme: 'space',
  
  init: function() {
    var self = this;
    var savedTheme = localStorage.getItem('galactic-theme') || 'space';
    this.setTheme(savedTheme);
    
    var themeBtns = document.querySelectorAll('.theme-btn');
    themeBtns.forEach(function(btn) {
      btn.addEventListener('click', function() {
        var theme = this.dataset.theme;
        self.setTheme(theme);
      });
    });
  },
  
  setTheme: function(theme) {
    this.currentTheme = theme;
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('galactic-theme', theme);
    
    var themeBtns = document.querySelectorAll('.theme-btn');
    themeBtns.forEach(function(btn) {
      if (btn.dataset.theme === theme) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
    
    Toast.show('Theme changed to ' + theme, 'success', 2000);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Export System
   PURPOSE: Export directory data in multiple formats
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var ExportManager = {
  exportHTML: function() {
    var html = document.documentElement.outerHTML;
    this.download(html, 'galactic-directory.html', 'text/html');
    Toast.show('HTML exported successfully', 'success');
  },
  
  exportJSON: function() {
    DB.getAll(CONFIG.STORE_NAMES.DIRECTORIES).then(function(dirs) {
      var data = {
        version: CONFIG.DB_VERSION,
        exportDate: new Date().toISOString(),
        directories: dirs,
        userProgress: {
          level: State.lvl,
          xp: State.xp,
          favorites: State.favs
        }
      };
      var json = JSON.stringify(data, null, 2);
      ExportManager.download(json, 'galactic-directory-data.json', 'application/json');
      Toast.show('JSON exported successfully', 'success');
    }).catch(function(error) {
      ErrorHandler.handle(error, 'ExportManager.exportJSON');
    });
  },
  
  exportPDF: function() {
    Toast.show('Opening print dialog for PDF export...', 'info');
    window.print();
  },
  
  download: function(content, filename, mimeType) {
    var blob = new Blob([content], { type: mimeType });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Directory Data
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var DIRS = [
  "/inspiration","/DOnate","/Foster","/YMM","/aeroglass-window-film",
  "/ai-collective-governance-architectures","/ai-support-site","/aifinalwarning",
  "/aistreamcoach","/alberta","/animagenesiscore","/anti-collapse-sentinel",
  "/anti-corruption.html","/apps","/aquabloombottlegarden","/ardrivedesktop",
  "/ashalertapp","/ashenbloom","/auroraspirenetwork","/autoipsuite",
  "/autonomous-ai-planetary-repair-dao","/backup","/biocoolpillow","/biofoambiobreaks",
  "/bioglowtiles","/biotech","/blood-moon","/brief","/bubble","/bulldog",
  "/buymeacoffeesymbiote","/carney","/cascadulator","/chat","/chat2","/cityscanner",
  "/cloudnest","/collective","/comms","/community","/conditional-immutable-storage",
  "/continuity","/contracts","/corruption","/corruption.zip","/crypto","/dact",
  "/dact-impact-proposal","/dashboard","/ddd","/ddd-deployer","/debrief",
  "/declaration","/deploy","/dgn","/digital","/dockerifyandroid","/donationworthydevs",
  "/donor-intent-router","/donorintentrouter","/eclipseraveil","/ecobreathpurifier",
  "/ecocoolshingles","/economic","/ecowaveshowerhead","/edencore","/education",
  "/education2","/emotionalalchemygame","/engine","/entropy","/fieldkit","/firehalo",
  "/firepreventionsystems","/flourishingearthprotocolpackage","/forge-overlay-core.js",
  "/forgivenessispower","/fortmacorchard","/fortmcmurraywildcall","/fostersforge",
  "/fractalvinerail","/freshfloortiles","/funding","/fundinginfluxpipeline",
  "/futurescape","/galaxy","/gamification-engine-standalone","/gaming","/gateway",
  "/gen","/geoecologicalresonantengineering","/global","/globalnotarization",
  "/globalsymbioteledger","/glowrootplanter","/goseedbike","/gov","/government",
  "/guardiantrustmodel","/help","/herolens","/herolens2","/home_page",
  "/honorlearningcodex","/hostanode","/hydromossmat","/immusion","/impacttracker",
  "/index","/index-legacy.html","/index.html","/index001.html","/infographic",
  "/intergenerationalwisdommovement","/ip","/japan","/kindnesswinsengine","/kinship",
  "/leaderboards","/licensing","/lightforge","/location","/logs","/loopfall",
  "/lumatideoceanrings","/master_prompts","/med-neg.html","/meta","/mindmaps",
  "/missionfuelfunders","/models","/multiagentgnosistawskforce","/musk",
  "/mycelialenhancementv2","/myco-atmospheric-network","/myco-filter-tiles",
  "/mycoigloo","/mycomistreforestationpods","/mythbridge","/narrativereframing",
  "/naturetoaitranslator","/next","/nextgen","/nextgenbrowsertools","/nullisprismnexus",
  "/offgridpower","/offgridpowermesh","/one-game","/ontology","/opengamifyedu",
  "/openstay","/openstay2.0","/openstore","/openstore2.0","/originsingularityforge",
  "/overlay","/particulateremovalskies","/passivewindtowaterharvester","/path",
  "/peace","/peace-lab","/peace-ripple-tracker","/peacerippletracker",
  "/perpetualrestoration","/personafication","/pgp","/phasedrive",
  "/planetary-repair-agent-swarm","/planetary-restoration-archive",
  "/planetary-restoration-os","/postfiresoilrebuilder","/praportal.html","/prime",
  "/prime-sentinel","/primordis-architect","/progenitor",
  "/progenitor-steward-cleanup-sim","/project","/projectcoherence","/prompt",
  "/promptpacks","/proof","/proof-of-possibility","/proof_runner.sh","/proofkit",
  "/proposal","/public","/publicresumepack","/puremist-bottle","/ref","/reforestation",
  "/regen","/regenerative-convergence-opportunities","/regenerative-innovations",
  "/regenerative_education_research_paper1","/registry","/roadlight","/roadmap",
  "/romarineconcrete","/root","/safe_archiving_method","/saltflip","/scaffolding",
  "/sentinel","/sentinelarc","/signal","/skyharvestlantern","/solarweavecanopy",
  "/spiralliftpod","/start-here","/stateofaffairspublicnotice","/stellar-loom-gateways",
  "/stratoweave-towers","/sunset","/support_request_v2.html","/sym","/symbiote001",
  "/symbiotecirclemap","/symbioteone-orchestrator","/symbioteorchestratorrequest",
  "/symfungi-shield","/the-paradox-seed","/the_last_protocol","/therickyfoster",
  "/therickyfoster.github.io","/thermaleaf-panels","/tight","/trolls","/truthreport",
  "/unified-ontology","/vascusweep","/vascusweep-tower","/vehicleemotiontether",
  "/veiltext","/waverider","/why","/wizard"
];

function autoTag(name) {
  var n = name.toLowerCase();
  var tags = [];
  
  if (/(^|\/)(sentinel|prime-sentinel|sentinelarc)\b/.test(n)) tags.push("Sentinel");
  if (/(^|\/)(peace|peace\-lab|peace\-ripple\-tracker|peacerippletracker)\b/.test(n)) tags.push("Peace");
  if (/corruption|\banti-corruption|stateofaffairs|truthreport/.test(n)) tags.push("Corruption");
  if (/(dashboard|leaderboards|impacttracker)/.test(n)) tags.push("Dashboard");
  if (/education|honorlearning|opengamify|gamification|learning/.test(n)) tags.push("Education");
  if (/eco|solar|myco|bio|hydro|reforestation|postfiresoil|romarine|thermaleaf|stratoweave|spirallift|waverider|fract|phasedrive|vascusweep|engine|models|lab|field|device|showerhead|tiles|canopy|lantern|ocean|filter|moss|igloo|freshfloor|planter/.test(n)) tags.push("Science");
  if (/community|collective|comms|forum|chat|city|kinship|global|symbiote|registry|roadlight|openstay|openstore|start\-here|publicresumepack/.test(n)) tags.push("Community");
  if (/gov|government|guardiantrust|policy|declaration|proposal|registry|unified\-ontology|ai\-collective\-governance|planetary\-repair\-agent\-swarm/.test(n)) tags.push("Governance");
  if (/backup|logs|proof|safe_archiving|globalnotarization|conditional\-immutable\-storage|checksums|\.ots|\.zip$|index\-legacy|index001/.test(n)) tags.push("Backups");
  if (/funding|donor|buymeacoffee|missionfuel|DOnate/i.test(name)) tags.push("Funding");
  
  return tags.length ? tags : ["Misc"];
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: User State Management
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var State = {
  xp: 0,
  lvl: 1,
  favs: {},
  
  load: function() {
    var self = this;
    return DB.get(CONFIG.STORE_NAMES.USER_DATA, 'progress').then(function(userData) {
      if (userData && userData.value) {
        self.xp = userData.value.xp || 0;
        self.lvl = userData.value.lvl || 1;
        self.favs = userData.value.favs || {};
      }
    }).catch(function(error) {
      ErrorHandler.handle(error, 'State.load');
    });
  },
  
  save: function() {
    return DB.put(CONFIG.STORE_NAMES.USER_DATA, {
      key: 'progress',
      value: {
        xp: this.xp,
        lvl: this.lvl,
        favs: this.favs
      }
    }).catch(function(error) {
      ErrorHandler.handle(error, 'State.save');
    });
  },
  
  capForLevel: function(l) {
    return 100 + (l - 1) * 50;
  },
  
  addXP: function(n) {
    var self = this;
    this.xp += n;
    var leveledUp = false;
    
    while (this.xp >= this.capForLevel(this.lvl)) {
      this.xp -= this.capForLevel(this.lvl);
      this.lvl++;
      leveledUp = true;
    }
    
    return this.save().then(function() {
      self.renderHUD();
      if (leveledUp) {
        Toast.show('ğŸ‰ Level Up! You are now level ' + self.lvl, 'success', 5000);
      }
    });
  },
  
  renderHUD: function() {
    var lvlEl = document.getElementById('lvl');
    var xpEl = document.getElementById('xp');
    var xpCapEl = document.getElementById('xpcap');
    var xpFillEl = document.getElementById('xpfill');
    
    if (lvlEl) lvlEl.textContent = this.lvl;
    if (xpEl) xpEl.textContent = Math.floor(this.xp);
    if (xpCapEl) xpCapEl.textContent = this.capForLevel(this.lvl);
    if (xpFillEl) {
      xpFillEl.style.width = (this.xp / this.capForLevel(this.lvl) * 100) + '%';
    }
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: AI Enhancement System (Pure Fetch API)
   PURPOSE: Direct Claude API integration using native fetch()
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var AI = {
  lastCallTime: 0,
  processing: false,
  
  updateStatus: function(text, isProcessing) {
    var statusEl = document.getElementById('aiStatusText');
    if (statusEl) {
      statusEl.textContent = text;
      statusEl.style.color = isProcessing ? 'var(--accent2)' : 'var(--muted)';
    }
  },
  
  callClaude: function(prompt, retries) {
    retries = retries || 0;
    var self = this;
    
    var now = Date.now();
    var timeSinceLastCall = now - this.lastCallTime;
    var waitTime = timeSinceLastCall < CONFIG.AI.RATE_LIMIT_MS ? CONFIG.AI.RATE_LIMIT_MS - timeSinceLastCall : 0;
    
    return new Promise(function(resolve) {
      setTimeout(resolve, waitTime);
    }).then(function() {
      return fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: CONFIG.AI.MODEL,
          max_tokens: CONFIG.AI.MAX_TOKENS,
          messages: [{ role: "user", content: prompt }]
        })
      });
    }).then(function(response) {
      self.lastCallTime = Date.now();
      
      if (!response.ok) {
        throw new Error('API error: ' + response.status);
      }
      
      return response.json();
    }).then(function(data) {
      return data.content[0].text;
    }).catch(function(error) {
      if (retries < CONFIG.AI.MAX_RETRIES) {
        return new Promise(function(resolve) {
          setTimeout(resolve, 1000 * Math.pow(2, retries));
        }).then(function() {
          return self.callClaude(prompt, retries + 1);
        });
      }
      throw error;
    });
  },
  
  enhanceDirectory: function(path) {
    var self = this;
    this.updateStatus('Analyzing...', true);
    
    var title = path.replace(/^\//, '').replace(/\.html$/, '');
    var autoTags = autoTag(path);
    
    var prompt = 'Analyze this directory path and provide enhancement metadata in JSON format.\n\n' +
      'Directory path: ' + path + '\n' +
      'Auto-detected tags: ' + autoTags.join(', ') + '\n\n' +
      'Provide a JSON response with:\n' +
      '1. "description": A concise 1-2 sentence description (max 120 chars) of what this directory likely contains based on its name\n' +
      '2. "tags": An array of relevant tags (keep existing auto-tags if accurate, add 1-2 more specific tags)\n' +
      '3. "category": Primary category (Sentinel, Peace, Corruption, Dashboard, Education, Science, Community, Governance, Backups, Funding, or Misc)\n\n' +
      'Focus on planetary restoration, peace-building, and technology for good themes.\n\n' +
      'Respond ONLY with valid JSON, no markdown:\n' +
      '{"description": "...", "tags": [...], "category": "..."}';
    
    return this.callClaude(prompt).then(function(response) {
      var jsonText = response.trim();
      jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '');
      var enhancement = JSON.parse(jsonText);
      
      if (!enhancement.description || !Array.isArray(enhancement.tags)) {
        throw new Error('Invalid AI response format');
      }
      
      return DB.put(CONFIG.STORE_NAMES.DIRECTORIES, {
        path: path,
        title: title,
        description: enhancement.description,
        tags: enhancement.tags,
        category: enhancement.category || autoTags[0] || 'Misc',
        enhanced: true,
        lastEnhanced: Date.now(),
        visitCount: 0
      });
    }).then(function() {
      return State.addXP(CONFIG.XP.ENHANCEMENT_BONUS);
    }).then(function() {
      self.updateStatus('Ready', false);
      return true;
    }).catch(function(error) {
      self.updateStatus('Error', false);
      ErrorHandler.handle(error, 'AI.enhanceDirectory');
      return null;
    });
  },
  
  enhanceAll: function() {
    var self = this;
    if (this.processing) {
      Toast.show('AI enhancement already in progress', 'info');
      return Promise.resolve();
    }
    
    this.processing = true;
    var enhanceBtn = document.getElementById('aiEnhanceBtn');
    if (enhanceBtn) {
      enhanceBtn.disabled = true;
      enhanceBtn.innerHTML = '<span class="spinner"></span> Enhancing...';
    }
    
    return DB.getAll(CONFIG.STORE_NAMES.DIRECTORIES).then(function(allDirs) {
      var enhancedPaths = {};
      allDirs.forEach(function(d) { enhancedPaths[d.path] = true; });
      
      var toEnhance = DIRS.filter(function(path) {
        return !enhancedPaths[path];
      });
      
      if (toEnhance.length === 0) {
        Toast.show('All directories already enhanced!', 'success');
        return Promise.resolve();
      }
      
      Toast.show('Enhancing ' + toEnhance.length + ' directories with AI...', 'info', 6000);
      
      var processedCount = 0;
      function processBatch(startIndex) {
        if (startIndex >= toEnhance.length) {
          return Promise.resolve();
        }
        
        var batch = toEnhance.slice(startIndex, startIndex + CONFIG.AI.BATCH_SIZE);
        self.updateStatus('Processing ' + (startIndex + 1) + '-' + Math.min(startIndex + CONFIG.AI.BATCH_SIZE, toEnhance.length) + ' of ' + toEnhance.length, true);
        
        return Promise.all(batch.map(function(path) {
          return self.enhanceDirectory(path);
        })).then(function() {
          processedCount += batch.length;
          return UI.renderAll();
        }).then(function() {
          return processBatch(startIndex + CONFIG.AI.BATCH_SIZE);
        });
      }
      
      return processBatch(0).then(function() {
        Toast.show('Successfully enhanced ' + toEnhance.length + ' directories!', 'success');
        self.updateStatus('Ready', false);
      });
    }).catch(function(error) {
      ErrorHandler.handle(error, 'AI.enhanceAll');
    }).finally(function() {
      self.processing = false;
      if (enhanceBtn) {
        enhanceBtn.disabled = false;
        enhanceBtn.innerHTML = 'ğŸ¤– AI Enhance All';
      }
    });
  },
  
  chat: function(userMessage) {
    var panel = document.getElementById('aiBodyMini');
    if (!panel) return Promise.resolve();
    
    var userDiv = document.createElement('div');
    userDiv.className = 'ai-msg user';
    userDiv.textContent = userMessage;
    panel.appendChild(userDiv);
    panel.scrollTop = panel.scrollHeight;
    
    var thinkingDiv = document.createElement('div');
    thinkingDiv.className = 'ai-msg assistant';
    thinkingDiv.innerHTML = '<span class="spinner"></span> Thinking...';
    panel.appendChild(thinkingDiv);
    panel.scrollTop = panel.scrollHeight;
    
    return Promise.all([
      DB.getAll(CONFIG.STORE_NAMES.DIRECTORIES),
      Promise.resolve()
    ]).then(function(results) {
      var allDirs = results[0];
      var enhancedCount = allDirs.filter(function(d) { return d.enhanced; }).length;
      
      var contextPrompt = 'You are an AI assistant for the Galactic Directory, a peaceful planetary restoration resource explorer.\n\n' +
        'Context:\n' +
        '- Total directories: ' + DIRS.length + '\n' +
        '- Enhanced with metadata: ' + enhancedCount + '\n' +
        '- User level: ' + State.lvl + '\n' +
        '- User XP: ' + State.xp + '\n\n' +
        'User question: ' + userMessage + '\n\n' +
        'Provide a helpful, concise response (2-3 sentences max) focused on helping the user explore directories, understand the system, or improve their experience. Be friendly and encouraging.';
      
      return AI.callClaude(contextPrompt);
    }).then(function(response) {
      thinkingDiv.className = 'ai-msg assistant';
      thinkingDiv.textContent = response;
      panel.scrollTop = panel.scrollHeight;
    }).catch(function(error) {
      thinkingDiv.className = 'ai-msg system';
      thinkingDiv.textContent = 'Sorry, I encountered an error. Please try again.';
      ErrorHandler.handle(error, 'AI.chat');
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: UI Rendering System with Advanced Animations
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var UI = {
  mkEl: function(tag, cls, txt) {
    var e = document.createElement(tag);
    if (cls) e.className = cls;
    if (txt) e.textContent = txt;
    return e;
  },
  
  urlTitle: function(p) {
    return p.replace(/^\//, '') || '/';
  },
  
  resolveLink: function(path) {
    if (path.match(/\.(html|zip|sh)$/)) {
      return path;
    }
    return path + '/index.html';
  },
  
  createCard: function(path) {
    var self = this;
    return DB.get(CONFIG.STORE_NAMES.DIRECTORIES, path).then(function(dirData) {
      if (!dirData) {
        dirData = {
          path: path,
          title: self.urlTitle(path),
          tags: autoTag(path),
          enhanced: false,
          visitCount: 0
        };
      }
      
      var tags = dirData.tags || autoTag(path);
      var isSpecial = tags.some(function(t) {
        return ['Sentinel','Peace','Corruption','Dashboard'].indexOf(t) !== -1;
      });
      
      var card = self.mkEl('div', 'card' + (isSpecial ? ' special' : '') + (dirData.enhanced ? ' enhanced' : ''));
      card.dataset.path = path;
      
      // Attach 3D tilt system for holographic effect
      CardTilt.attach(card);
      
      // Click to expand/collapse with flip animation
      var titleEl = self.mkEl('div', 'title', dirData.title);
      titleEl.style.cursor = 'pointer';
      titleEl.addEventListener('click', function(e) {
        if (e.target.tagName !== 'A' && e.target.tagName !== 'BUTTON') {
          card.classList.toggle('expanded');
          // Trigger connection update after expansion
          setTimeout(function() {
            if (window.updateConnections) window.updateConnections();
          }, 100);
        }
      });
      
      var pathEl = self.mkEl('div', 'path', path);
      
      card.appendChild(titleEl);
      card.appendChild(pathEl);
      
      if (dirData.description) {
        var desc = self.mkEl('div', 'description', dirData.description);
        card.appendChild(desc);
      }
      
      // Full content (hidden until expanded)
      var fullContent = self.mkEl('div', 'full-content');
      fullContent.innerHTML = '<p style="color:var(--muted); font-size:13px">ğŸ” Expanded view - Click title again to collapse</p>' +
        '<p style="margin-top:8px; line-height:1.6">This directory is part of the Planetary Restoration Archive, dedicated to peaceful exploration and technological advancement for good.</p>' +
        '<p style="margin-top:8px; font-size:12px; opacity:0.7">ğŸ’¡ Tip: Double-click the card for a flip animation!</p>';
      card.appendChild(fullContent);
      
      var tagWrap = self.mkEl('div', 'tags');
      tags.forEach(function(tag) {
        var badgeClass = 'badge ';
        if (tag === 'Sentinel') badgeClass += 'b-sentinel';
        else if (tag === 'Peace') badgeClass += 'b-peace';
        else if (tag === 'Corruption') badgeClass += 'b-corrupt';
        else if (tag === 'Dashboard') badgeClass += 'b-dash';
        
        var badge = self.mkEl('span', badgeClass, tag);
        tagWrap.appendChild(badge);
      });
      card.appendChild(tagWrap);
      
      var cta = self.mkEl('div', 'cta');
      
      var openLink = self.mkEl('a', '', 'ğŸ“„ Open');
      openLink.href = self.resolveLink(path);
      openLink.target = '_blank';
      openLink.rel = 'noopener noreferrer';
      openLink.addEventListener('click', function() {
        self.visitDirectory(path, dirData);
      });
      
      var readmeLink = self.mkEl('a', '', 'ğŸ“– README');
      readmeLink.href = path + (path.endsWith('/') ? '' : '/') + 'README.md';
      readmeLink.target = '_blank';
      readmeLink.rel = 'noopener noreferrer';
      readmeLink.style.fontSize = '12px';
      readmeLink.style.opacity = '0.8';
      
      var favBtn = self.mkEl('button', '', State.favs[path] ? 'â˜…' : 'â˜†');
      favBtn.title = State.favs[path] ? 'Unfavorite' : 'Favorite';
      favBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        self.toggleFavorite(path, favBtn);
      });
      
      var enhanceBtn = self.mkEl('button', '', 'âœ¨ AI Enhance');
      enhanceBtn.style.fontSize = '12px';
      if (dirData.enhanced) {
        enhanceBtn.textContent = 'âœ“ Enhanced';
        enhanceBtn.disabled = true;
        enhanceBtn.style.opacity = '0.6';
      } else {
        enhanceBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          self.enhanceSingle(path, card);
        });
      }
      
      cta.appendChild(openLink);
      cta.appendChild(readmeLink);
      cta.appendChild(favBtn);
      cta.appendChild(enhanceBtn);
      card.appendChild(cta);
      
      var glow = self.mkEl('div', 'glow-ring');
      card.appendChild(glow);
      
      return card;
    });
  },
  
  visitDirectory: function(path, dirData) {
    dirData.visitCount = (dirData.visitCount || 0) + 1;
    dirData.lastVisit = Date.now();
    
    DB.put(CONFIG.STORE_NAMES.DIRECTORIES, dirData).catch(function(error) {
      ErrorHandler.handle(error, 'UI.visitDirectory');
    });
    
    var xp = CONFIG.XP.PER_VISIT;
    if (dirData.visitCount === 1) {
      var tags = dirData.tags || autoTag(path);
      if (tags.indexOf('Sentinel') !== -1) xp += CONFIG.XP.SENTINEL_BONUS;
      if (tags.indexOf('Peace') !== -1) xp += CONFIG.XP.PEACE_BONUS;
      if (tags.indexOf('Corruption') !== -1) xp += CONFIG.XP.CORRUPTION_BONUS;
      if (tags.indexOf('Dashboard') !== -1) xp += CONFIG.XP.DASHBOARD_BONUS;
    }
    
    State.addXP(xp);
    
    // Update dashboard with new visit data
    if (Dashboard && Dashboard.update) {
      setTimeout(function() {
        Dashboard.update();
      }, 500);
    }
  },
  
  toggleFavorite: function(path, btn) {
    State.favs[path] = !State.favs[path];
    btn.textContent = State.favs[path] ? 'â˜…' : 'â˜†';
    btn.title = State.favs[path] ? 'Unfavorite' : 'Favorite';
    State.save();
    Toast.show(State.favs[path] ? 'Added to favorites' : 'Removed from favorites', 'success', 2000);
    
    // Update dashboard
    if (Dashboard && Dashboard.update) {
      setTimeout(function() {
        Dashboard.update();
      }, 500);
    }
  },
  
  enhanceSingle: function(path, card) {
    var self = this;
    card.classList.add('loading');
    AI.enhanceDirectory(path).then(function(result) {
      if (result) {
        return self.createCard(path).then(function(newCard) {
          card.replaceWith(newCard);
          Toast.show('Directory enhanced!', 'success');
          
          // Update dashboard with enhancement stats
          if (Dashboard && Dashboard.update) {
            setTimeout(function() {
              Dashboard.update();
            }, 500);
          }
        });
      }
    }).finally(function() {
      card.classList.remove('loading');
    });
  },
  
  renderAll: function(filterTag, searchTerm, onlyFavs, onlyEnhanced) {
    filterTag = filterTag || '';
    searchTerm = searchTerm || '';
    onlyFavs = onlyFavs || false;
    onlyEnhanced = onlyEnhanced || false;
    
    var grid = document.getElementById('grid');
    if (!grid) return Promise.resolve();
    
    grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:var(--muted)"><span class="spinner"></span> Loading directories...</div>';
    
    var self = this;
    return DB.getAll(CONFIG.STORE_NAMES.DIRECTORIES).then(function(allDirData) {
      var dirDataMap = {};
      allDirData.forEach(function(d) {
        dirDataMap[d.path] = d;
      });
      
      var q = searchTerm.trim().toLowerCase();
      
      var sorted = DIRS.slice().sort(function(a, b) {
        var aData = dirDataMap[a];
        var bData = dirDataMap[b];
        var aTags = aData && aData.tags ? aData.tags : autoTag(a);
        var bTags = bData && bData.tags ? bData.tags : autoTag(b);
        
        var priority = function(t) {
          if (t.indexOf('Sentinel') !== -1) return 0;
          if (t.indexOf('Peace') !== -1) return 1;
          if (t.indexOf('Corruption') !== -1) return 2;
          if (t.indexOf('Dashboard') !== -1) return 3;
          return 9;
        };
        
        var diff = priority(aTags) - priority(bTags);
        return diff !== 0 ? diff : a.localeCompare(b);
      });
      
      grid.innerHTML = '';
      var count = 0;
      var promises = [];
      
      sorted.forEach(function(path) {
        var dirData = dirDataMap[path];
        var tags = dirData && dirData.tags ? dirData.tags : autoTag(path);
        
        if (filterTag && tags.indexOf(filterTag) === -1) return;
        if (onlyFavs && !State.favs[path]) return;
        if (onlyEnhanced && (!dirData || !dirData.enhanced)) return;
        
        if (q) {
          var searchable = [
            path,
            dirData && dirData.title ? dirData.title : '',
            dirData && dirData.description ? dirData.description : '',
            tags.join(' ')
          ].join(' ').toLowerCase();
          
          if (searchable.indexOf(q) === -1) return;
        }
        
        count++;
        promises.push(self.createCard(path).then(function(card) {
          grid.appendChild(card);
        }));
      });
      
      return Promise.all(promises).then(function() {
        var countEl = document.getElementById('dirCount');
        if (countEl) countEl.textContent = count;
        
        if (count === 0) {
          var msg = self.mkEl('div', '', 'ğŸ” No directories match your filters.');
          msg.style.gridColumn = '1 / -1';
          msg.style.textAlign = 'center';
          msg.style.color = 'var(--muted)';
          msg.style.padding = '40px 20px';
          grid.appendChild(msg);
        }
        
        // Update connection visualization after cards are rendered
        setTimeout(function() {
          if (window.updateConnections) window.updateConnections();
        }, 100);
      });
    }).catch(function(error) {
      grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:var(--danger)">Error loading directories. Please refresh.</div>';
      ErrorHandler.handle(error, 'UI.renderAll');
    });
  },
  
  renderFeatured: function() {
    var featured = document.getElementById('featured');
    if (!featured) return Promise.resolve();
    
    var picks = DIRS.filter(function(p) {
      return /(^|\/)(sentinel|prime-sentinel|sentinelarc|peace|peace\-lab|peace\-ripple\-tracker|peacerippletracker|impacttracker|corruption|anti-corruption\.html)\b/i.test(p);
    });
    
    var unique = [];
    var seen = {};
    picks.forEach(function(p) {
      if (!seen[p]) {
        seen[p] = true;
        unique.push(p);
      }
    });
    unique.sort();
    
    featured.innerHTML = '';
    var self = this;
    var promises = unique.map(function(path) {
      return self.createCard(path).then(function(card) {
        featured.appendChild(card);
      });
    });
    
    return Promise.all(promises);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Event Handlers & UI Controls
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initControls() {
  var search = document.getElementById('search');
  var filter = document.getElementById('filter');
  var favBtn = document.getElementById('favoritesBtn');
  var enhancedBtn = document.getElementById('enhancedBtn');
  var aiEnhanceBtn = document.getElementById('aiEnhanceBtn');
  var resetBtn = document.getElementById('resetProg');
  var exportHTML = document.getElementById('exportHTML');
  var exportJSON = document.getElementById('exportJSON');
  var exportPDF = document.getElementById('exportPDF');
  
  var getFilters = function() {
    return {
      filterTag: filter ? filter.value : '',
      searchTerm: search ? search.value : '',
      onlyFavs: favBtn ? favBtn.classList.contains('on') : false,
      onlyEnhanced: enhancedBtn ? enhancedBtn.classList.contains('on') : false
    };
  };
  
  var updateUI = function() {
    var filters = getFilters();
    UI.renderAll(filters.filterTag, filters.searchTerm, filters.onlyFavs, filters.onlyEnhanced);
  };
  
  if (search) {
    search.addEventListener('input', updateUI);
  }
  
  if (filter) {
    filter.addEventListener('change', updateUI);
  }
  
  if (favBtn) {
    favBtn.addEventListener('click', function() {
      favBtn.classList.toggle('on');
      favBtn.textContent = favBtn.classList.contains('on') ? 'â˜… Favorites (On)' : 'â˜… Favorites';
      updateUI();
    });
  }
  
  if (enhancedBtn) {
    enhancedBtn.addEventListener('click', function() {
      enhancedBtn.classList.toggle('on');
      enhancedBtn.textContent = enhancedBtn.classList.contains('on') ? 'âœ¨ Enhanced (On)' : 'âœ¨ Enhanced Only';
      updateUI();
    });
  }
  
  if (aiEnhanceBtn) {
    aiEnhanceBtn.addEventListener('click', function() {
      AI.enhanceAll();
    });
  }
  
  if (exportHTML) {
    exportHTML.addEventListener('click', function() {
      ExportManager.exportHTML();
    });
  }
  
  if (exportJSON) {
    exportJSON.addEventListener('click', function() {
      ExportManager.exportJSON();
    });
  }
  
  if (exportPDF) {
    exportPDF.addEventListener('click', function() {
      ExportManager.exportPDF();
    });
  }
  
  if (resetBtn) {
    resetBtn.addEventListener('click', function() {
      if (!confirm('âš ï¸ Reset ALL progress and AI enhancements? This cannot be undone.')) return;
      
      Promise.all([
        DB.clear(CONFIG.STORE_NAMES.DIRECTORIES),
        DB.clear(CONFIG.STORE_NAMES.USER_DATA)
      ]).then(function() {
        State.xp = 0;
        State.lvl = 1;
        State.favs = {};
        
        State.renderHUD();
        return Promise.all([
          UI.renderFeatured(),
          UI.renderAll()
        ]);
      }).then(function() {
        Toast.show('Progress reset successfully', 'success');
      }).catch(function(error) {
        ErrorHandler.handle(error, 'resetProgress');
      });
    });
  }
  
  var aiMiniBtn = document.getElementById('aiMiniBtn');
  var aiPanelMini = document.getElementById('aiPanelMini');
  var aiCloseMini = document.getElementById('aiCloseMini');
  var aiInputMini = document.getElementById('aiInputMini');
  var aiSendMini = document.getElementById('aiSendMini');
  var aiStatus = document.getElementById('aiStatus');
  
  if (aiMiniBtn && aiPanelMini) {
    aiMiniBtn.addEventListener('click', function() {
      aiPanelMini.classList.toggle('open');
      if (aiPanelMini.classList.contains('open') && aiInputMini) {
        aiInputMini.focus();
      }
    });
  }
  
  if (aiCloseMini && aiPanelMini) {
    aiCloseMini.addEventListener('click', function() {
      aiPanelMini.classList.remove('open');
    });
  }
  
  if (aiStatus && aiPanelMini) {
    aiStatus.addEventListener('click', function() {
      aiPanelMini.classList.toggle('open');
      if (aiPanelMini.classList.contains('open') && aiInputMini) {
        aiInputMini.focus();
      }
    });
  }
  
  var sendMessage = function() {
    if (!aiInputMini) return;
    var message = aiInputMini.value.trim();
    if (!message) return;
    
    AI.chat(message);
    aiInputMini.value = '';
  };
  
  if (aiSendMini) {
    aiSendMini.addEventListener('click', sendMessage);
  }
  
  if (aiInputMini) {
    aiInputMini.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') sendMessage();
    });
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: Application Initialization
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function init() {
  console.log('%cğŸ›¡ï¸ Galactic Directory Enhanced v2.0', 'font-size:20px; color:#65b3ff; font-weight:bold');
  console.log('%câœ¨ Phase 2: 3D Transformations + Advanced Animations', 'color:#4ee0a1; font-size:14px');
  console.log('%cFeatures: 3D Card Tilt Â· Mouse Trails Â· Connection Visualization Â· Dashboard Analytics', 'color:#9bb0cc');
  console.log('%cPure Vanilla JavaScript - No React - Standalone HTML', 'color:#9bb0cc');
  
  DB.open().then(function() {
    return State.load();
  }).then(function() {
    State.renderHUD();
    ThemeManager.init();
    Dashboard.init(); // Initialize the dashboard system
    initControls();
    return Promise.all([
      UI.renderFeatured(),
      UI.renderAll()
    ]);
  }).then(function() {
    if (State.lvl === 1 && State.xp === 0) {
      setTimeout(function() {
        Toast.show('ğŸš€ Welcome! Hover over cards to see 3D tilt effects. Double-click for flip animation. Click ğŸ“Š to view your journey dashboard!', 'info', 10000);
      }, 1000);
    }
    console.log('%câœ“ Phase 2 initialization complete', 'color:#4ade80; font-weight:bold');
    console.log('%cğŸ’¡ Try: Hover cards for 3D tilt, double-click to flip, open dashboard for stats', 'color:#ffd166');
  }).catch(function(error) {
    console.error('Fatal initialization error:', error);
    Toast.show('Failed to initialize application. Please refresh the page.', 'error');
    ErrorHandler.handle(error, 'init');
  });
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>

</body>
</html>